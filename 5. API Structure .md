now what is the db structure scheme and api calls?

2 minutes ago
â€¢
see context
Revert this
Base44 AI
Base44

Thought for 2s
Database Structure & API Calls in base44
Database Structure
How base44 Stores Data
base44 uses a document-based NoSQL structure with JSON Schema validation:

Each Entity = A Collection of Documents
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Entity: "Order"                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Document 1: {                      â”‚
â”‚    id: "abc123",                    â”‚
â”‚    order_number: "ORD-001",         â”‚
â”‚    customer_name: "John Doe",       â”‚
â”‚    total_amount: 150.00,            â”‚
â”‚    status: "delivered",             â”‚
â”‚    company_id: "xyz789",            â”‚
â”‚    created_date: "2025-01-15T...",  â”‚
â”‚    updated_date: "2025-01-15T...",  â”‚
â”‚    created_by: "user@email.com"     â”‚
â”‚  }                                  â”‚
â”‚  Document 2: { ... }                â”‚
â”‚  Document 3: { ... }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Entity Definition (JSON Schema)
Entities are defined as JSON Schema files in entities/ folder:

{
  "name": "Order",
  "type": "object",
  "properties": {
    "order_number": {
      "type": "string",
      "description": "Unique order identifier"
    },
    "customer_name": {
      "type": "string"
    },
    "total_amount": {
      "type": "number"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "confirmed", "delivered", "cancelled"],
      "default": "pending"
    },
    "company_id": {
      "type": "string",
      "description": "Associated company ID"
    }
  },
  "required": ["order_number", "customer_name", "total_amount", "company_id"]
}
Built-in Fields (Automatic)
Every entity automatically gets these fields:

{
  id: "auto-generated-unique-id",
  created_date: "2025-01-15T10:30:00Z",  // ISO timestamp
  updated_date: "2025-01-15T10:30:00Z",  // ISO timestamp
  created_by: "user@email.com"            // Email of creator
}
You DON'T define these in your schema - base44 adds them automatically.

API Calls via SDK
1. Importing the SDK
import { base44 } from '@/api/base44Client';
The SDK is pre-initialized with app credentials - you don't need to configure it.

2. Entity Operations
CREATE - Add a new record
// Create a single record
const newOrder = await base44.entities.Order.create({
  order_number: "ORD-001",
  customer_name: "John Doe",
  total_amount: 150.00,
  status: "pending",
  company_id: "abc123"
});

// Returns:
// {
//   id: "generated-id",
//   order_number: "ORD-001",
//   customer_name: "John Doe",
//   total_amount: 150.00,
//   status: "pending",
//   company_id: "abc123",
//   created_date: "2025-01-15T10:30:00Z",
//   updated_date: "2025-01-15T10:30:00Z",
//   created_by: "user@email.com"
// }
Bulk CREATE - Add multiple records at once
const newOrders = await base44.entities.Order.bulkCreate([
  { order_number: "ORD-001", customer_name: "John", total_amount: 150, company_id: "abc" },
  { order_number: "ORD-002", customer_name: "Jane", total_amount: 200, company_id: "abc" },
  { order_number: "ORD-003", customer_name: "Bob", total_amount: 175, company_id: "xyz" }
]);

// Returns array of created records with IDs
LIST - Get all records (with sorting/pagination)
// Get all orders (default: 50 results)
const orders = await base44.entities.Order.list();

// With sorting (descending by created_date)
const recentOrders = await base44.entities.Order.list('-created_date');

// With sorting and limit
const top10Orders = await base44.entities.Order.list('-total_amount', 10);

// Sorting options:
// 'field_name'  -> ascending
// '-field_name' -> descending
FILTER - Query with conditions
// Simple filter - exact match
const pendingOrders = await base44.entities.Order.filter({
  status: "pending"
});

// Multiple conditions (AND logic)
const companyPendingOrders = await base44.entities.Order.filter({
  status: "pending",
  company_id: "abc123"
});

// Array filter - match any value
const activeOrders = await base44.entities.Order.filter({
  status: { $in: ["pending", "confirmed"] }
});

// Multiple IDs
const specificCompanies = await base44.entities.Order.filter({
  company_id: { $in: ["abc123", "xyz789"] }
});

// Greater than / Less than
const highValueOrders = await base44.entities.Order.filter({
  total_amount: { $gte: 500 }  // >= 500
});

const oldOrders = await base44.entities.Order.filter({
  created_date: { $lte: "2024-12-31T23:59:59Z" }  // <= date
});

// Range filter
const rangeOrders = await base44.entities.Order.filter({
  total_amount: { 
    $gte: 100,  // >= 100
    $lte: 500   // <= 500
  }
});

// With sorting
const recentHighValue = await base44.entities.Order.filter(
  { total_amount: { $gte: 500 } },
  '-created_date',  // sort descending
  20                // limit 20 results
);
Filter Operators:

$in:  [val1, val2]    // Match any value in array
$gte: value           // Greater than or equal
$lte: value           // Less than or equal
$gt:  value           // Greater than
$lt:  value           // Less than
$ne:  value           // Not equal
GET - Retrieve single record by ID
const order = await base44.entities.Order.get("record-id-here");

// Returns single object or throws error if not found
// {
//   id: "record-id-here",
//   order_number: "ORD-001",
//   ...
// }
UPDATE - Modify existing record
// Update specific fields
await base44.entities.Order.update("record-id", {
  status: "delivered",
  delivery_time: new Date().toISOString()
});

// Only updates the fields you specify
// Other fields remain unchanged
// updated_date automatically updates
DELETE - Remove record
await base44.entities.Order.delete("record-id");

// Permanently deletes the record
// Cannot be undone
3. User Entity (Special Built-in)
The User entity has special methods:

// Get current logged-in user
const currentUser = await base44.auth.me();
// Returns: { id, email, full_name, role, app_role, ... }

// Update current user's data
await base44.auth.updateMe({
  phone: "+1234567890",
  company_filter: ["abc123", "xyz789"],
  theme: "dark"
});

// Check if user is authenticated
const isLoggedIn = await base44.auth.isAuthenticated();
// Returns: true or false

// Logout
await base44.auth.logout();
// Redirects to login page

// Redirect to login
await base44.auth.redirectToLogin("/dashboard");
// Takes user to login, then back to /dashboard after success
IMPORTANT: You CANNOT create users programmatically:

// âŒ THIS DOESN'T WORK:
await base44.entities.User.create({ ... });  // ERROR!

// âœ… Users must be invited via base44 dashboard
// Then you can UPDATE their details:
await base44.entities.User.update("user-id", {
  app_role: "admin",
  company_id: "abc123"
});
4. Entity Schema Access
// Get the JSON schema for an entity
const orderSchema = await base44.entities.Order.schema();

// Returns:
// {
//   name: "Order",
//   type: "object",
//   properties: { ... },
//   required: [ ... ]
// }

// Useful for:
// - Generating forms dynamically
// - Validation
// - Documentation
Complete CRUD Example
import React, { useState, useEffect } from 'react';
import { base44 } from '@/api/base44Client';

export default function OrderManager() {
  const [orders, setOrders] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  // READ - Load all orders
  useEffect(() => {
    loadOrders();
  }, []);

  const loadOrders = async () => {
    setIsLoading(true);
    try {
      const data = await base44.entities.Order.filter(
        { status: { $in: ["pending", "confirmed"] } },
        '-created_date',
        50
      );
      setOrders(data);
    } catch (error) {
      console.error("Failed to load orders:", error);
    } finally {
      setIsLoading(false);
    }
  };

  // CREATE - Add new order
  const handleCreate = async (orderData) => {
    try {
      const newOrder = await base44.entities.Order.create(orderData);
      setOrders([newOrder, ...orders]);  // Add to top of list
    } catch (error) {
      console.error("Failed to create order:", error);
    }
  };

  // UPDATE - Change order status
  const handleStatusChange = async (orderId, newStatus) => {
    try {
      await base44.entities.Order.update(orderId, { status: newStatus });
      
      // Update local state
      setOrders(orders.map(order => 
        order.id === orderId 
          ? { ...order, status: newStatus }
          : order
      ));
    } catch (error) {
      console.error("Failed to update order:", error);
    }
  };

  // DELETE - Remove order
  const handleDelete = async (orderId) => {
    try {
      await base44.entities.Order.delete(orderId);
      
      // Remove from local state
      setOrders(orders.filter(order => order.id !== orderId));
    } catch (error) {
      console.error("Failed to delete order:", error);
    }
  };

  if (isLoading) return <div>Loading...</div>;

  return (
    <div>
      <h1>Orders</h1>
      {orders.map(order => (
        <div key={order.id}>
          <span>{order.order_number} - ${order.total_amount}</span>
          <button onClick={() => handleStatusChange(order.id, "delivered")}>
            Mark Delivered
          </button>
          <button onClick={() => handleDelete(order.id)}>
            Delete
          </button>
        </div>
      ))}
    </div>
  );
}
Common Patterns
Pattern 1: Company-Filtered Data
const loadOrdersByCompany = async (companyIds) => {
  let filter = {};
  
  // If not viewing "all" companies
  if (!companyIds.includes('all') && companyIds.length > 0) {
    filter.company_id = { $in: companyIds };
  }
  
  const orders = await base44.entities.Order.filter(filter, '-created_date');
  return orders;
};
Pattern 2: Date Range Filtering
const loadOrdersInDateRange = async (startDate, endDate) => {
  const filter = {
    created_date: {
      $gte: startDate.toISOString(),
      $lte: endDate.toISOString()
    }
  };
  
  const orders = await base44.entities.Order.filter(filter);
  return orders;
};
Pattern 3: Pagination
const loadOrdersPage = async (page = 1, pageSize = 20) => {
  const orders = await base44.entities.Order.list(
    '-created_date',
    pageSize
  );
  
  // Note: base44 doesn't have built-in offset pagination
  // You'd need to implement cursor-based pagination
  // or load all and paginate client-side
  
  return orders;
};
Pattern 4: Aggregations (Client-Side)
const calculateTotalRevenue = async (companyId) => {
  const orders = await base44.entities.Order.filter({
    company_id: companyId,
    status: "delivered"
  });
  
  const total = orders.reduce((sum, order) => sum + order.total_amount, 0);
  return total;
};
Error Handling
try {
  const order = await base44.entities.Order.create(data);
} catch (error) {
  // Common errors:
  
  // 404 - Entity not found
  if (error.response?.status === 404) {
    console.error("Entity doesn't exist");
  }
  
  // 400 - Validation error (missing required fields)
  if (error.response?.status === 400) {
    console.error("Invalid data:", error.response.data);
  }
  
  // 429 - Rate limit exceeded
  if (error.response?.status === 429) {
    console.error("Too many requests, retry later");
  }
  
  // 403 - Permission denied (RLS)
  if (error.response?.status === 403) {
    console.error("No permission to access this data");
  }
}
Summary
Entity Definition: JSON Schema in entities/ folder
Data Storage: NoSQL document collections
API Access: Via base44.entities.EntityName SDK methods

Core Methods:

create(data) - Add one record
bulkCreate([data]) - Add multiple records
list(sort, limit) - Get all records
filter(conditions, sort, limit) - Query records
get(id) - Get one record by ID
update(id, data) - Modify record
delete(id) - Remove record
schema() - Get entity schema
Special User Methods:

base44.auth.me() - Get current user
base44.auth.updateMe(data) - Update current user
base44.auth.isAuthenticated() - Check login status
base44.auth.logout() - Log out
That's the complete database and API structure! ðŸš€