give me an extensive break down of how the admin portal works and its funcionality and layout

40 minutes ago
•
see context
Revert this
Base44 AI
Base44

Thought for 2s
Extensive Breakdown of the Admin Portal
Table of Contents
Overview & Architecture
Layout Structure
Navigation System
Core Features by Section
Key Workflows
Permissions & Security
Data Relationships
Overview & Architecture
Purpose
The Admin Portal is the command center of the entire TimeFlow Operations platform. It provides administrators with:

Complete visibility into all operations across both L&M and My Time companies
Full control over all entities, users, and configurations
Advanced analytics and reporting capabilities
System-wide settings and integrations management
Technical Foundation
Role-Based Access: Users with app_role: 'admin' get access to this portal
Multi-Company Support: Admins can view/manage data across multiple companies simultaneously
Real-Time Updates: Uses React Query for efficient data fetching and caching
Responsive Design: Mobile-first approach with desktop optimizations
Layout Structure
Master Layout Component (Layout.js)
The layout wraps all pages and provides consistent navigation and branding.

Key Elements:
1. Collapsible Sidebar (Left)

┌─────────────────────────────────────┐
│  Logo + Company Name                │ <- Dynamic company branding
│  Role Badge (Admin)                 │
├─────────────────────────────────────┤
│  Collapse/Expand Button             │
├─────────────────────────────────────┤
│  Navigation Menu                    │
│  ├─ Dashboard                       │
│  ├─ Analytics                       │
│  ├─ Operations (expandable)         │
│  │  ├─ Clients                      │
│  │  ├─ Departments                  │
│  │  ├─ Stores                       │
│  │  ├─ Staff                        │
│  │  ├─ Users                        │
│  │  └─ Companies                    │
│  ├─ Financials (expandable)         │
│  │  ├─ Financials                   │
│  │  ├─ Bookkeeping                  │
│  │  ├─ Payroll                      │
│  │  ├─ Invoices                     │
│  │  ├─ Invoice Requests             │
│  │  └─ Recurring Billing            │
│  ├─ Logistics (expandable)          │
│  │  ├─ Orders                       │
│  │  ├─ Inventory                    │
│  │  ├─ Products                     │
│  │  ├─ Vendors                      │
│  │  └─ Routes                       │
│  ├─ Support (expandable)            │
│  │  ├─ Disputes                     │
│  │  └─ Chat                         │
│  └─ System (expandable)             │
│     ├─ Settings                     │
│     └─ User Logs                    │
├─────────────────────────────────────┤
│  User Profile Dropdown              │
│  ├─ Account Settings                │
│  ├─ Theme Toggle                    │
│  ├─ Language Toggle                 │
│  └─ Logout                          │
└─────────────────────────────────────┘
Sidebar States:

Expanded (264px): Shows full navigation with icons and text
Collapsed (80px): Shows only icons with tooltips on hover
Mobile: Hidden by default, slides in as overlay when hamburger menu clicked
2. Top Bar (Mobile Only)

┌──────────────────────────────────────────────┐
│  ☰  Current Page Title    Lang  Avatar       │
└──────────────────────────────────────────────┘
3. Main Content Area

Dynamic Padding: Adjusts based on sidebar state
Full Height: Utilizes viewport height
Scrollable: Each page manages its own scroll
4. Company Toggle Component Located in the top-right of most pages, allows admins to:

┌─────────────────────────────────────┐
│  [ L&M ] [ My Time ] [ Both ] ⬇     │
└─────────────────────────────────────┘
Filter data by specific company or view all
State persists across sessions via User entity
Triggers companyFilterChanged event that pages listen to
Navigation System
Hierarchical Structure
The navigation is defined in components/navigation/navigationConfig.js:

navigationConfig.admin = [
  // Top-level items
  { title, icon, url },           // Direct page
  { title, icon, children: [...] } // Submenu
]
Navigation Features
1. Active State Detection

Highlights current page
Auto-expands parent menu if child is active
Visual feedback with blue accent color
2. Unread Badges

Chat shows unread message count
Real-time updates via polling
Red notification bubbles
3. Accordion Behavior

Click parent to expand/collapse children
Smooth animations using Framer Motion
State persists during session
4. Responsive Modes

Desktop Collapsed: Dropdown menus on hover
Desktop Expanded: Accordion-style submenus
Mobile: Full overlay menu
5. Tooltips

Appear when sidebar is collapsed
Show full menu item names
Positioned to the right of icons
Core Features by Section
1. DASHBOARD
Page: AdminDashboard.jsx

Layout Grid
┌──────────────────────────────────────────────────┐
│  Header: Title + Company Filter + Date Range + Export │
├──────────────────────────────────────────────────┤
│  KPI Cards (4 columns)                           │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐           │
│  │Rev   │ │Profit│ │Orders│ │Disputes│         │
│  └──────┘ └──────┘ └──────┘ └──────┘           │
├──────────────────────────────────────────────────┤
│  ┌────────────────┐ ┌──────────────┐           │
│  │Revenue Chart   │ │ Order Status │           │
│  │(2/3 width)     │ │ + Alerts     │           │
│  │                │ │ (1/3 width)  │           │
│  └────────────────┘ └──────────────┘           │
├──────────────────────────────────────────────────┤
│  ┌────────────────┐ ┌──────────────┐           │
│  │Recent Orders   │ │Low Stock     │           │
│  │(1/2 width)     │ │(1/2 width)   │           │
│  └────────────────┘ └──────────────┘           │
├──────────────────────────────────────────────────┤
│  Management Shortcuts (Customizable)             │
│  [Bookkeeping] [Inventory] [Users] [Stores]     │
└──────────────────────────────────────────────────┘
Key Features:
A. KPI Stats Cards (components/shared/StatsCard.jsx)

Total Revenue: Sum of all paid invoices in date range
Net Profit: Revenue minus total expenses
Total Orders: Count of orders in date range
Open Disputes: Count of unresolved disputes
Each shows:
Main value with currency/count formatting
Trend indicator (up/down arrow with percentage)
Icon representing the metric
Hover effect for interactivity
B. Revenue Chart (components/shared/RevenueChart.jsx)

Tabbed Views: Daily / Weekly / Monthly
Bar Chart: Uses Recharts library
Interactive Tooltips: Hover to see exact values
Data Aggregation: Groups transactions by selected period
Responsive: Adapts to container width
C. Order Status Card

Confirmed Orders: Count of orders awaiting preparation
In Transit: Orders currently out for delivery
Delivered: Successfully completed orders
Color-coded icons for quick recognition
D. Shrinkage Alerts Card

Critical Stock: Products with 0 quantity
Low Stock: Products below minimum threshold
Overdue Invoices: Past due date, unpaid
Urgent Disputes: High/critical priority open disputes
Failed Deliveries: Orders needing reschedule
Priority-colored badges and icons
Clickable to navigate to relevant management page
E. Recent Orders Table (components/shared/DataTable.jsx)

Shows last 5 orders
Columns: Order #, Customer, Amount, Status
Status badge with color coding
Click to view full order details
F. Low Stock Alerts Table

Shows products below minimum stock level
Columns: Product Name, SKU, In Stock, Min Stock
Red highlighting for critical items
Quick link to inventory management
G. Management Shortcuts

Customizable: Click edit icon to open modal
Drag & Drop: Reorder shortcuts using @hello-pangea/dnd
Add/Remove: Select from all available pages
Persistence: Saved to user profile (dashboard_shortcuts field)
Default Set: Bookkeeping, Inventory, Users, Stores
Modal shows all navigation items organized by category
H. Filters & Export

Company Toggle: Filter by L&M, My Time, or Both
Date Range Picker: Select custom date range (calendar UI)
Export PDF Button: Generates comprehensive report
Uses backend function exportDashboardPdf
Includes all visible data
Formatted with company branding
Downloads automatically
Data Loading Strategy:
// Rate-limited fetching with retries
fetchWithRetry(apiCall, entityName, retries = 2)
  - Handles 429 rate limit errors
  - Exponential backoff (10s, 15s)
  - Logs warnings to console
  
// Initial Load:
1. User profile (for preferences)
2. Companies list
3. Selected company filter applied

// Dashboard Data (after filters set):
1. Orders (filtered by company + date)
2. Invoices (filtered by company + date)
3. Products (filtered by company)
4. Disputes (filtered by company, status:open)
5. Stores (filtered by company)

// Aggregation happens client-side
Smart Alerts System:
generateAlertsWithTranslations(products, orders, disputes, invoices)
  Returns top 5 most critical alerts:
  1. Critical Stock (quantity = 0, status active)
  2. Low Stock (quantity <= min_stock_level)
  3. Overdue Invoices (past due_date, status pending)
  4. High Priority Disputes (priority high/critical)
  5. Failed Deliveries (status failed_delivery)
2. ANALYTICS
Page: AdminAnalytics.jsx

Purpose
Provides deep insights into business performance with interactive visualizations.

Layout
┌──────────────────────────────────────────────────┐
│  Header + Filters (Company, Date Range)          │
├──────────────────────────────────────────────────┤
│  KPI Cards Row (4 cards)                         │
│  Revenue | Expenses | Margin | Outstanding      │
├──────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────┐ │
│  │ Revenue vs Expenses Trend (Line/Bar Chart)│ │
│  │ (Full Width)                               │ │
│  └────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────┤
│  ┌──────────────────┐ ┌────────────────────────┐│
│  │ Top Products     │ │ Order Volume by Status ││
│  │ (Bar Chart)      │ │ (Pie/Donut Chart)      ││
│  └──────────────────┘ └────────────────────────┘│
├──────────────────────────────────────────────────┤
│  [Export PDF] [Export CSV] [Export Excel]        │
└──────────────────────────────────────────────────┘
Components:
A. Analytics Filters (components/analytics/AnalyticsFilters.jsx)

Company Filter: Dropdown with multi-select
Date Range: Calendar picker with presets (Last 7/30/90 days, YTD)
Metric Toggles: Show/hide specific data series
B. KPI Cards (components/analytics/AnalyticsKpiCard.jsx)

Total Revenue: Sum of paid invoices
Total Expenses: All expense entries
Gross Margin %: (Revenue - COGS) / Revenue * 100
Outstanding Invoices: Sum of unpaid invoice amounts
Each with:
Large formatted value
Comparison vs previous period (% change)
Color-coded trend indicators
Mini sparkline chart
C. Revenue vs Expenses Chart (components/analytics/RevenueExpenseChart.jsx)

Dual Axis: Revenue (bars), Expenses (line)
Time Grouping: Daily, Weekly, Monthly (tabbed)
Interactive Legend: Click to show/hide series
Crosshair Tooltip: Shows both metrics at point
Zoom & Pan: For detailed exploration
D. Top Products Chart (components/analytics/TopProductsChart.jsx)

Horizontal Bar Chart: Top 10 products by revenue
Sorted: Descending by total sales
Data Points: Product name, revenue amount, quantity sold
Click Handler: Navigate to product detail page
Color Scheme: Gradient based on value
E. Order Volume Chart (components/analytics/OrderVolumeChart.jsx)

Donut Chart: Orders grouped by status
Segments: Pending, Confirmed, In Transit, Delivered, Cancelled
Percentage Labels: Show % of total
Center Display: Total order count
Legend: Click to highlight segment
Export Functionality:
// PDF Export (exportAnalyticsPdf function)
- Header with company logo and date range
- Summary KPIs table
- Embedded chart images (generated server-side)
- Data tables for top products and order details
- Footer with page numbers

// CSV/Excel Export
- Raw data in tabular format
- Multiple sheets (Overview, Products, Orders, Financials)
- Formatted columns with proper data types
- Compatible with Excel, Google Sheets
Data Calculation Logic:
// KPIs calculated from:
1. Invoices (Revenue)
   - Filter: payment_status = 'paid'
   - Aggregate: SUM(total_amount)
   
2. Expenses (from Expense entity)
   - Filter: transaction_date in range
   - Aggregate: SUM(amount)
   
3. Gross Margin
   - Revenue - Cost of Goods Sold (from Product.cost_price * quantity)
   - Expressed as percentage
   
4. Outstanding
   - Filter: payment_status IN ('pending', 'overdue')
   - Aggregate: SUM(total_amount)
3. OPERATIONS SECTION
This section manages the organizational structure and human resources.

3.1 Clients (AdminClients.jsx)
Purpose: Manage customer/client accounts and relationships.

Layout:

┌──────────────────────────────────────────────────┐
│  Header + [Add Client] Button                    │
├──────────────────────────────────────────────────┤
│  Filters Card                                     │
│  [Search] [Company Filter] [Tier Filter]         │
│  [Status Filter]                                  │
├──────────────────────────────────────────────────┤
│  Client Table (DataTable component)              │
│  - Name                                           │
│  - Contact Person                                 │
│  - Email                                          │
│  - Phone                                          │
│  - Company                                        │
│  - Tier (Gold/Silver/Bronze)                     │
│  - Outstanding Balance                            │
│  - Status                                         │
│  - Actions (View/Edit/Delete)                    │
└──────────────────────────────────────────────────┘
Features:

Search: Real-time filtering by name, email, contact person
Tier System: Gold/Silver/Bronze/Standard classification
Outstanding Balance: Financial tracking integration
Detail Drawer: Slide-out panel showing:
Full client profile
Order history
Invoice summary
Payment history
Notes and communications
Revenue analytics
Client Form Modal (components/admin/ClientForm.jsx):

Fields:
- Name* (required)
- Legal Name
- Contact Person*
- Email*
- Phone*
- Billing Address
- Company Assignment* (dropdown)
- Tier (dropdown: gold/silver/bronze/standard)
- Status (dropdown: active/inactive/suspended)
- Default Currency (USD/DOP)
- Tax ID
- Notes (textarea)

Validation:
- Email format check
- Phone number format
- Required field indicators
Client Detail Drawer (components/admin/ClientDetailDrawer.jsx):

┌─────────────────────────────────────┐
│  ← Back    Client Name      [Edit]  │
├─────────────────────────────────────┤
│  Profile Section                    │
│  - Contact Info                     │
│  - Company                          │
│  - Tier Badge                       │
│  - Status Badge                     │
├─────────────────────────────────────┤
│  Financial Summary                  │
│  - Total Revenue                    │
│  - Outstanding Balance              │
│  - Last Order Date                  │
├─────────────────────────────────────┤
│  Tabs:                              │
│  [Orders] [Invoices] [Analytics]    │
│                                     │
│  Tab Content (scrollable)           │
└─────────────────────────────────────┘
Client Analytics (components/admin/CustomerAnalyticsDrawer.jsx):

Revenue trend over time
Order frequency
Average order value
Payment reliability score
Product preferences
Export to PDF functionality
3.2 Departments (AdminDepartments.jsx)
Purpose: Manage organizational departments across companies.

Key Features:

Simple CRUD operations
Company assignment (L&M, My Time, or shared)
Status management (active/inactive)
Department-level filtering in other modules
Table Columns:

| Name | Company | Status | Created Date | Actions |
Department Form (components/admin/DepartmentForm.jsx):

- Name* (text input)
- Company (dropdown: L&M, My Time, or null for shared)
- Status (dropdown: active/inactive)
Use Cases:

Department Managers are assigned to specific departments
Orders can be tagged to departments for cost allocation
Products can be allocated per department
Payroll entries linked to departments
3.3 Stores (AdminStores.jsx)
Purpose: Manage physical store locations and their details.

Layout:

┌──────────────────────────────────────────────────┐
│  Header + [Add Store] Button                     │
├──────────────────────────────────────────────────┤
│  Filters: [Search] [Company] [Type] [Status]     │
├──────────────────────────────────────────────────┤
│  Store Cards (Grid View) or Table View toggle    │
│  ┌────────┐ ┌────────┐ ┌────────┐              │
│  │ Store1 │ │ Store2 │ │ Store3 │              │
│  │ [icon] │ │ [icon] │ │ [icon] │              │
│  │Address │ │Address │ │Address │              │
│  │Phone   │ │Phone   │ │Phone   │              │
│  └────────┘ └────────┘ └────────┘              │
└──────────────────────────────────────────────────┘
Store Form (components/admin/StoreForm.jsx):

Basic Info:
- Name*
- Store Type* (retail/wholesale/restaurant/grocery/pharmacy/other)
- Company Assignment (dropdown or null for shared)
- Status (active/inactive/pending)

Contact Details:
- Address* (text area or map integration)
- Phone*
- Email
- Contact Person*
- Website URL

Operational Details:
- Business Hours (structured object)
  Monday: [09:00 - 17:00]
  Tuesday: [09:00 - 17:00]
  ...
- Description/Notes

Integration:
- Google Maps embedding for address verification
Business Hours Editor:

┌─────────────────────────────────────┐
│  Day      | Open    | Close  | ✓   │
│  Monday   | [09:00] | [17:00]| [✓] │
│  Tuesday  | [09:00] | [17:00]| [✓] │
│  ...                                │
│  [Copy to All Days] [Apply]         │
└─────────────────────────────────────┘
3.4 Staff (AdminStaff.jsx)
Purpose: Comprehensive staff management beyond basic user accounts.

Features:

Staff Directory: Visual cards or detailed list
Shift Management: Schedule creation and tracking
Performance Metrics: Delivery stats, ratings, earnings
Attendance Tracking: Clock in/out, time-off requests
Layout:

┌──────────────────────────────────────────────────┐
│  Header + Stats Row                              │
│  [Total Staff: 45] [On Duty: 12] [On Leave: 3]  │
├──────────────────────────────────────────────────┤
│  Filters: [Role] [Department] [Store] [Status]   │
├──────────────────────────────────────────────────┤
│  Staff List (component/admin/staff/StaffList)    │
│  ┌──────────────────────────────────────┐       │
│  │ [Avatar] Name                         │       │
│  │          Role | Department            │       │
│  │          Status Badge | [View]        │       │
│  ├──────────────────────────────────────┤       │
│  │ ... more staff members               │       │
│  └──────────────────────────────────────┘       │
└──────────────────────────────────────────────────┘
Staff Detail Drawer (components/admin/staff/StaffDetailDrawer.jsx):

Tabs:
1. Profile
   - Personal info
   - Contact details
   - Employment details (hire date, position, rate)
   
2. Schedule
   - Current week view
   - Upcoming shifts
   - [Add Shift] button
   
3. Performance
   - For delivery staff:
     * Deliveries completed
     * On-time rate
     * Customer ratings
     * Total earnings
     * Tips collected
   - For other roles:
     * Hours worked
     * Tasks completed
     * Notes from supervisors
     
4. Documents
   - Uploaded files (contracts, certifications)
   - Generated payroll reports
Shift Form (components/admin/staff/ShiftForm.jsx):

- Staff Member* (dropdown)
- Shift Date*
- Start Time*
- End Time*
- Role for this shift (driver, warehouse, etc.)
- Store/Location
- Notes
- [Save] [Cancel]
Staff Stats Cards (components/admin/staff/StaffStatsCard.jsx):

Color-coded KPIs
Quick glance at team metrics
Click to filter staff list
3.5 Users (AdminUsers.jsx)
Purpose: Manage system user accounts, roles, and permissions.

Key Distinction from Staff:

Users: System accounts with login credentials
Staff: Operational personnel records (subset of users + additional data)
Features:

View All Users: Complete list with role indicators
Invite Users: Opens base44 dashboard (users must be invited via platform)
Edit User Details: Update profile info, assign roles, set company/department
Role Assignment: admin, operations_manager, department_manager, delivery_staff
Status Management: active, inactive, suspended
Layout:

┌──────────────────────────────────────────────────┐
│  Header + [Invite User 🔗] Button                │
├──────────────────────────────────────────────────┤
│  ⓘ Info Alert:                                   │
│  "To invite new users, use the base44 dashboard."│
├──────────────────────────────────────────────────┤
│  Filters: [Search] [Role] [Status]               │
├──────────────────────────────────────────────────┤
│  User Table                                       │
│  | Name | Email | Phone | Company | Role | Status│
│  | Actions: [Edit]                               │
└──────────────────────────────────────────────────┘
User Form (components/admin/UserForm.jsx):

(Edit Mode Only - Cannot create via form)

Profile:
- Full Name*
- Email* (read-only if editing)
- Phone*
- Avatar URL (upload)

Role & Access:
- App Role* (dropdown: admin, operations_manager, etc.)
- Status (active/inactive/suspended)

Assignments:
- Company (dropdown, can be null)
- Department (dropdown, filtered by company)
- Store (dropdown, filtered by company)

Employment:
- Employee ID*
- Position/Title*
- Hire Date*
- Hourly Rate* (default: 15.00)
- Overtime Rate* (default: 22.50)

Preferences:
- Language (en/es)
- Theme (light/dark)
- Company Filter (multi-select or "all")

[Save] [Cancel]
Important Note: The system prevents admins from directly creating user accounts. Instead:

Click "Invite User" button
Opens base44 dashboard in new tab
Invite user via email through dashboard
User receives invitation email
User accepts and creates account
Return to Admin Users page
Edit the new user to assign role and details
3.6 Companies (AdminCompanies.jsx)
Purpose: Manage company entities (L&M and My Time).

Features:

Company Profiles: Basic info and legal details
Branding Settings: Logos, colors, visual identity
Company-wide Settings: Configurations affecting all users/data
Layout:

┌──────────────────────────────────────────────────┐
│  Header + [Add Company] Button                   │
├──────────────────────────────────────────────────┤
│  Company Cards (Large Visual)                    │
│  ┌────────────────────┐ ┌────────────────────┐ │
│  │  [Logo/Icon]       │ │  [Logo/Icon]       │ │
│  │  L&M               │ │  My Time           │ │
│  │  Distribution LLC  │ │  Services Corp     │ │
│  │                    │ │                    │ │
│  │  Tax ID: xxx       │ │  Tax ID: xxx       │ │
│  │  Created: date     │ │  Created: date     │ │
│  │                    │ │                    │ │
│  │  [Edit] [Settings] │ │  [Edit] [Settings] │ │
│  └────────────────────┘ └────────────────────┘ │
├──────────────────────────────────────────────────┤
│  ⓘ Initialize Default Companies button          │
│  (if no companies exist)                         │
└──────────────────────────────────────────────────┘
Company Form (components/admin/CompanyForm.jsx):

Basic Information:
- Name* (e.g., "L&M")
- Legal Name* (e.g., "L&M Distribution LLC")
- Tax ID/EIN

Branding:
- Logo Upload (drag & drop or file picker)
- Primary Color (color picker)
- Secondary Color (color picker)
- Preview of branding

Settings (JSON Object):
{
  "default_currency": "USD",
  "fiscal_year_start": "01-01",
  "tax_rate": 0.0825,
  "invoice_prefix": "LM-",
  "order_prefix": "ORD-"
}

[Save] [Cancel]
Initialize Functionality: If no companies exist, a special button appears:

┌────────────────────────────────────┐
│  No Companies Found                │
│                                    │
│  [Initialize L&M and My Time]     │
│                                    │
│  Creates both companies with       │
│  default settings automatically.   │
└────────────────────────────────────┘
This creates:

L&M (blue theme)
My Time (green theme) With proper legal names and default settings.
4. FINANCIALS SECTION
The financial section is the heart of the platform's monetary management.

4.1 Financials Overview (AdminFinancials.jsx)
Purpose: High-level financial dashboard showing key metrics across all financial operations.

Layout:

┌──────────────────────────────────────────────────┐
│  Header + Filters (Company, Date Range)          │
├──────────────────────────────────────────────────┤
│  Financial KPI Grid (2x3)                        │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │Revenue  │ │Expenses │ │Net Prof │           │
│  └─────────┘ └─────────┘ └─────────┘           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │Cash Flow│ │Receivabl│ │Payables │           │
│  └─────────┘ └─────────┘ └─────────┘           │
├──────────────────────────────────────────────────┤
│  ┌────────────────┐ ┌──────────────┐           │
│  │ P&L Chart      │ │ Cash Flow    │           │
│  │ (Time series)  │ │ (Waterfall)  │           │
│  └────────────────┘ └──────────────┘           │
├──────────────────────────────────────────────────┤
│  Quick Actions                                    │
│  [Record Income] [Record Expense] [Make Payment] │
│  [View Reports] [Reconcile Accounts]             │
└──────────────────────────────────────────────────┘
Features:

Real-time financial calculations
Comparison to previous period
Drill-down to detailed pages
Export financial summary
Charts (components/admin/ProfitChart.jsx, components/admin/CashFlowChart.jsx):

Interactive visualizations using Recharts
Monthly/quarterly/yearly views
Stacked/grouped configurations
Color-coded profit/loss periods
4.2 Bookkeeping (AdminBookkeeping.jsx)
Purpose: Double-entry accounting system with comprehensive ledger management.

Core Concept: Every financial transaction is recorded as a Ledger Entry with:

Type: income, expense, vendor_payment, transfer
Amount: positive for income, negative for expenses
Status: pending → completed → verified
Links to source documents (invoices, expenses, etc.)
Layout:

┌──────────────────────────────────────────────────┐
│  Bookkeeping Dashboard                           │
│  Filters: [Company] [Date Range] [Entry Type]    │
│           [Status] [Category]                    │
├──────────────────────────────────────────────────┤
│  Summary Cards                                    │
│  [Total Income] [Total Expenses] [Net] [Pending] │
├──────────────────────────────────────────────────┤
│  Ledger Entries Table                            │
│  | Date | Type | Counterparty | Category |       │
│  | Amount | Status | Actions |                   │
│  ├────────────────────────────────────┤         │
│  │ Sortable, Filterable, Searchable   │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ New Entry] [Import Transactions] [Reconcile] │
│  [Export Ledger] [Generate Reports]              │
└──────────────────────────────────────────────────┘
Ledger Entry Form (components/admin/LedgerEntryForm.jsx):

Type*: [Income ▼] [Expense] [Vendor Payment] [Transfer]

Based on Type, form adjusts:

IF Income:
- Amount* (positive)
- Counterparty* (customer/client name)
- Category* (Sales Revenue, Service Income, Other Income)
- Date*
- Reference ID (link to Invoice/Order)
- Notes

IF Expense:
- Amount* (positive, stored as negative)
- Counterparty* (vendor/supplier)
- Category* (Office Supplies, Utilities, Payroll, etc.)
- Date*
- Receipt URL (upload)
- Notes

IF Vendor Payment:
- Vendor* (dropdown from Supplier entity)
- Amount*
- Payment Method (check, ACH, wire, card)
- Reference Number (check #, transaction ID)
- Date*
- Related Invoices (multi-select)

IF Transfer:
- From Account*
- To Account*
- Amount*
- Transfer Type (internal, external, etc.)
- Date*
- Description

Status: [Pending ▼] [Completed] [Verified] [Cancelled]
Due Date: (for pending items)

[Save & New] [Save] [Cancel]
Verification Workflow:

Entry created with status "pending"
Bookkeeper reviews physical documents
Clicks "Verify Payment" action
System records:
verified_by: current user ID
verified_at: timestamp
status changes to "verified"
Verified entries included in reports
Reconciliation:

Compare ledger vs bank statements
Mark discrepancies
Generate reconciliation report
Track outstanding items
Analytics Section (components/admin/BookkeepingAnalytics.jsx):

┌─────────────────────────────────────┐
│  Income vs Expense Trend            │
│  (Line chart over time)             │
├─────────────────────────────────────┤
│  Category Breakdown                 │
│  (Pie charts: Income & Expense)     │
├─────────────────────────────────────┤
│  Cash Flow Projection               │
│  (Forecast based on historical)     │
└─────────────────────────────────────┘
Export Options:

PDF Report: Formatted ledger with totals
CSV: Raw data for Excel/analysis
QuickBooks Export: Compatible format (if integration set up)
4.3 Payroll (AdminPayroll.jsx)
Purpose: Comprehensive payroll management system with automated calculations and compliance tracking.

Layout:

┌──────────────────────────────────────────────────┐
│  Payroll Dashboard                               │
│  Period: [Current Pay Period ▼] [Navigate <  >] │
├──────────────────────────────────────────────────┤
│  Summary Cards                                    │
│  [Gross] [Deductions] [Net] [Pending Approval]  │
├──────────────────────────────────────────────────┤
│  Tabs: [Entries] [Calendar] [Reports]            │
│                                                   │
│  ENTRIES TAB:                                    │
│  Filters: [Employee] [Department] [Status]       │
│  ┌───────────────────────────────────────┐      │
│  │ Payroll Entries Table                 │      │
│  │ | Employee | Hours | Gross | Net |    │      │
│  │ | Status | Actions |                  │      │
│  └───────────────────────────────────────┘      │
│  [+ New Entry] [Bulk Generate] [Approve All]    │
└──────────────────────────────────────────────────┘
Payroll Entry Form (components/admin/PayrollEntryForm.jsx):

Employee*: [Select Employee ▼]
  (Shows: Name, Current Rate, Department)

Pay Period*:
- Start Date*
- End Date*

Hours Calculation:
┌─────────────────────────────────────┐
│ Regular Hours*: [___] x $15.00      │
│                 = $___.__           │
│                                     │
│ Overtime Hours: [___] x $22.50     │
│                 = $___.__           │
├─────────────────────────────────────┤
│ Gross Pay:      $___.__             │
└─────────────────────────────────────┘

Deductions:
- Tax Withholding: $___.__
- Insurance: $___.__
- Other: $___.__
Total Deductions: $___.__

Net Pay: $___.__  (auto-calculated)

Payment:
- Method: [ACH ▼] [Check] [Cash] [Direct Deposit]
- Status: [Pending ▼] [Approved] [Paid]

Notes: (optional)

[Calculate] [Save] [Save & Approve] [Cancel]
Automated Calculations:

calculatePayroll(employee, hours, overtimeHours) {
  const regularPay = hours * employee.hourly_rate;
  const overtimePay = overtimeHours * employee.overtime_rate;
  const grossPay = regularPay + overtimePay;
  
  // Deductions (configurable)
  const taxRate = 0.20; // 20% federal
  const insuranceFlat = 50;
  
  const taxWithholding = grossPay * taxRate;
  const totalDeductions = taxWithholding + insuranceFlat;
  
  const netPay = grossPay - totalDeductions;
  
  return { grossPay, totalDeductions, netPay };
}
Payroll Calendar (components/admin/PayrollCalendar.jsx):

┌───────────────────────────────────────────┐
│  [< December 2024 >]                      │
├───────────────────────────────────────────┤
│  Sun Mon Tue Wed Thu Fri Sat              │
│   1   2   3   4   5   6   7              │
│   8   9  10  11  12  13  14              │
│  15  16  17 [18] 19  20  21 <- Pay Day   │
│  22  23  24  25  26  27  28              │
│  29  30  31                               │
├───────────────────────────────────────────┤
│  Pay Period: Dec 1 - Dec 15               │
│  Payday: Dec 18                           │
│  Status: [Pending Approval]               │
│                                           │
│  [View Entries] [Generate Payroll]        │
└───────────────────────────────────────────┘
Payroll Schedule Modal (components/admin/PayrollScheduleModal.jsx):

Set recurring pay periods (weekly, bi-weekly, semi-monthly, monthly)
Define payday (e.g., Friday after period end)
Configure automatic generation
Holiday handling rules
Bulk Actions (components/admin/BulkPayrollActions.jsx):

Bulk Generate: Create entries for all employees for current period
Bulk Approve: Approve all pending entries at once
Bulk Export: Export all entries to CSV/PDF
Bulk Mark as Paid: Update status after payment processing
Payroll Entry Drawer (components/admin/PayrollEntryDrawer.jsx):

┌─────────────────────────────────────┐
│  ← Employee Name                    │
│  Pay Period: Dec 1 - Dec 15         │
├─────────────────────────────────────┤
│  Hours Breakdown:                   │
│  Regular:  80 hrs @ $15.00          │
│  Overtime:  5 hrs @ $22.50          │
├─────────────────────────────────────┤
│  Earnings:                          │
│  Regular Pay:    $1,200.00          │
│  Overtime Pay:   $112.50            │
│  Gross Pay:      $1,312.50          │
├─────────────────────────────────────┤
│  Deductions:                        │
│  Tax:            $262.50            │
│  Insurance:      $50.00             │
│  Total:          $312.50            │
├─────────────────────────────────────┤
│  Net Pay:        $1,000.00          │
├─────────────────────────────────────┤
│  Status: [Pending ▼]                │
│  Payment Method: [ACH ▼]            │
│                                     │
│  [Approve] [Edit] [Delete]          │
└─────────────────────────────────────┘
Reports:

Payroll Summary by Period
Employee Earnings Statement
Tax withholding report
Department cost allocation
YTD earnings per employee
Integration with Bookkeeping: When payroll is marked "paid", system automatically:

Creates LedgerEntry for expense
Links to PayrollEntry
Updates company cash flow
Records in financial reports
4.4 Invoices (AdminInvoices.jsx)
Purpose: Complete invoice lifecycle management from creation to payment.

Layout:

┌──────────────────────────────────────────────────┐
│  Invoice Management                              │
│  Filters: [Company] [Status] [Customer]          │
│           [Date Range] [Payment Status]          │
├──────────────────────────────────────────────────┤
│  Summary Metrics                                  │
│  [Total Outstanding] [Paid This Month]           │
│  [Overdue Count] [Draft Count]                   │
├──────────────────────────────────────────────────┤
│  Invoice Table                                    │
│  | Invoice # | Customer | Order | Amount |       │
│  | Due Date | Status | Payment | Actions |       │
│  ├────────────────────────────────────┤         │
│  │ Color-coded by status and overdue  │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ Create Invoice] [Bulk Actions ▼]             │
│  [Export] [Send Reminders]                       │
└──────────────────────────────────────────────────┘
Invoice Status Flow:

Draft → Sent → Paid
  ↓      ↓       ↑
Cancelled  Overdue
Invoice Detail View (Full Page: InvoiceDetailView.jsx):

┌──────────────────────────────────────────────────┐
│  ← Back to Invoices                              │
│  Invoice #LM-INV-001                    [Edit]   │
├──────────────────────────────────────────────────┤
│  Company Header (Logo + Info)                    │
├──────────────────────────────────────────────────┤
│  Bill To:                                        │
│  Customer Name                                   │
│  Address                                         │
│  Email, Phone                                    │
├──────────────────────────────────────────────────┤
│  Invoice Details:                                │
│  Invoice Date: Dec 15, 2024                      │
│  Due Date: Dec 30, 2024                          │
│  Order Reference: #ORD-123                       │
├──────────────────────────────────────────────────┤
│  Line Items Table:                               │
│  | Item | Description | Qty | Rate | Amount |   │
│  ├────────────────────────────────────┤         │
│  │ Product 1 | ... | 10 | $50 | $500 │         │
│  │ Product 2 | ... | 5  | $30 | $150 │         │
│  └────────────────────────────────────┘         │
│                                                   │
│  Subtotal:          $650.00                      │
│  Tax (8.25%):       $53.63                       │
│  Total:             $703.63                      │
├──────────────────────────────────────────────────┤
│  Payment Status: [Paid ✓]                        │
│  Payment Date: Dec 20, 2024                      │
│  Payment Method: ACH                             │
├──────────────────────────────────────────────────┤
│  Actions:                                         │
│  [Download PDF] [Send Email] [Record Payment]    │
│  [Mark as Paid] [Void Invoice] [Duplicate]       │
└──────────────────────────────────────────────────┘
Creating/Editing Invoices: Invoices are typically auto-generated from orders, but admins can:

Manually create invoices
Edit draft invoices (item, quantities, prices)
Adjust amounts before sending
Add notes or payment terms
Invoice Form (Modal):

Customer*: [Select Customer ▼]
Order Reference: [Select Order ▼] (optional, links invoice to order)

Items:
┌─────────────────────────────────────────────┐
│ + Add Item                                  │
│ ┌─────────────────────────────────────────┐│
│ │Product: [Select ▼]                      ││
│ │Qty: [__] x $__.___ = $____.___          ││
│ │[Remove]                                 ││
│ └─────────────────────────────────────────┘│
│ ... more items                              │
└─────────────────────────────────────────────┘

Dates:
- Invoice Date*: [Date Picker]
- Due Date*: [Date Picker] (default: +15 days)

Amounts:
- Subtotal: $___.___ (calculated)
- Tax Rate: [__]% → $___.__
- Total: $___.___ (calculated)

Status: [Draft ▼] [Sent] [Paid] [Cancelled]
Payment Status: [Pending ▼] [Paid]

Notes: (internal)
Payment Terms: (displayed on invoice)

[Generate PDF] [Save as Draft] [Save & Send]
PDF Generation:

Uses company branding (logo, colors)
Professional invoice template
Includes all line items and totals
Payment instructions
Stored in cloud storage
URL saved to invoice record
Email Functionality:

To: customer@email.com
Subject: Invoice #LM-INV-001 from L&M Distribution

Dear [Customer Name],

Please find attached your invoice #LM-INV-001 for the 
amount of $703.63.

Due Date: December 30, 2024
Payment Methods: [ACH, Check, Wire]

If you have any questions, please don't hesitate to contact us.

Thank you for your business!

---
L&M Distribution LLC
Phone: (XXX) XXX-XXXX
Email: billing@lm.com

[Pay Now Button] - links to payment portal (if enabled)

Attachment: Invoice_LM-INV-001.pdf
Bulk Actions:

Send payment reminders for overdue invoices
Mark multiple as paid
Export selected to CSV
Bulk void/cancel
Payment Recording: When marking invoice as paid:

Update invoice.payment_status = 'paid'
Record payment date
Create LedgerEntry (income)
Update Customer.outstanding_balance
Trigger webhook (if configured)
4.5 Invoice Requests (AdminInvoiceRequests.jsx)
Purpose: Handle invoice edit requests from Operations Managers who cannot directly modify invoices.

Workflow:

Operations Manager needs invoice change
       ↓
Creates InvoiceEditRequest
       ↓
Admin receives notification
       ↓
Reviews request in dedicated page
       ↓
Approves or Rejects with notes
       ↓
If approved: applies changes to invoice
       ↓
Operations Manager gets notified
Layout:

┌──────────────────────────────────────────────────┐
│  Invoice Edit Requests                           │
│  Filters: [Status] [Urgency] [Requester]         │
├──────────────────────────────────────────────────┤
│  Pending Requests (Badge count)                  │
│  ┌─────────────────────────────────────────┐    │
│  │ [High Priority Badge]                    │    │
│  │ Invoice #LM-INV-123                      │    │
│  │ Requested by: John Doe                   │    │
│  │ Reason: Customer disputed line item      │    │
│  │ Date: 2 hours ago                        │    │
│  │ [Review] [Quick Approve] [Reject]        │    │
│  ├─────────────────────────────────────────┤    │
│  │ ... more requests                        │    │
│  └─────────────────────────────────────────┘    │
├──────────────────────────────────────────────────┤
│  Processed Requests (Collapsible)                │
└──────────────────────────────────────────────────┘
Request Detail Modal (components/admin/ReviewInvoiceRequestModal.jsx):

┌──────────────────────────────────────────────────┐
│  Review Invoice Edit Request                     │
├──────────────────────────────────────────────────┤
│  Request Info:                                    │
│  Requester: John Doe (Operations Manager)        │
│  Submitted: Dec 15, 2024 2:30 PM                 │
│  Urgency: [High]                                 │
├──────────────────────────────────────────────────┤
│  Invoice: #LM-INV-123                            │
│  Customer: ABC Corp                              │
│  Current Total: $1,500.00                        │
├──────────────────────────────────────────────────┤
│  Reason for Edit:                                │
│  "Customer disputed Product X quantity. Should   │
│   be 10 units, not 15."                          │
├──────────────────────────────────────────────────┤
│  Requested Changes:                              │
│  ┌─────────────────────────────────────────┐    │
│  │ Field: Line Item 1 - Quantity           │    │
│  │ Current: 15                              │    │
│  │ Proposed: 10                             │    │
│  │                                          │    │
│  │ Impact: Total reduces to $1,250.00       │    │
│  └─────────────────────────────────────────┘    │
├──────────────────────────────────────────────────┤
│  Current Invoice (Preview)                       │
│  [View Full Invoice]                             │
├──────────────────────────────────────────────────┤
│  Admin Decision:                                  │
│  ⚪ Approve Changes                               │
│  ⚪ Reject Request                                │
│                                                   │
│  Notes to Requester:                             │
│  [Text area for response]                        │
│                                                   │
│  [Submit Decision] [Cancel]                      │
└──────────────────────────────────────────────────┘
Notification System:

Admin sees badge count on Invoice Requests nav item
Operations Manager sees notification when request is processed
Email notifications for urgent requests
Change History (components/shared/ChangeHistory.jsx): All approved invoice changes are logged:

┌─────────────────────────────────────┐
│  Change History                     │
├─────────────────────────────────────┤
│  Dec 20, 2024 - 3:45 PM             │
│  Modified by: Admin (Jane Smith)    │
│  Reason: Edit request #REQ-456      │
│                                     │
│  Changes:                           │
│  • Quantity: 15 → 10                │
│  • Total: $1,500 → $1,250           │
│                                     │
│  Approved by: Jane Smith            │
│  Notes: "Approved per customer      │
│          dispute resolution"        │
├─────────────────────────────────────┤
│  ... older changes                  │
└─────────────────────────────────────┘
4.6 Recurring Billing (AdminRecurringBilling.jsx)
Purpose: Manage subscription-based billing for regular clients.

Key Concepts:

Subscription: Ongoing service with regular billing
Billing Interval: daily, weekly, monthly, quarterly, yearly
Auto-Renewal: Automatically charges customer
Layout:

┌──────────────────────────────────────────────────┐
│  Recurring Billing Management                    │
│  Filters: [Status] [Interval] [Customer]         │
├──────────────────────────────────────────────────┤
│  Summary Cards                                    │
│  [Active Subs] [Monthly Recurring] [Churned]     │
├──────────────────────────────────────────────────┤
│  Subscription Table                              │
│  | Customer | Service | Amount | Interval |      │
│  | Next Bill | Status | Actions |                │
│  ├────────────────────────────────────┤         │
│  │ Color-coded by status              │         │
│  │ Upcoming bills highlighted         │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ New Subscription] [Upcoming Charges]         │
│  [Failed Payments] [Export]                      │
└──────────────────────────────────────────────────┘
Subscription Form (components/admin/SubscriptionForm.jsx):

Customer*: [Select Department Manager ▼]
  (Auto-fills: name, email, company, store, dept)

Service Details:
- Service Name*: [e.g., "Monthly Product Delivery"]
- Description: [Details about the service]

Pricing:
- Amount*: $___.__
- Currency: [USD ▼] [DOP]
- Billing Interval*: [Monthly ▼]
  Options: Daily, Weekly, Bi-weekly, Monthly, Quarterly, Yearly
- Billing Day: [__] (1-31 for monthly, day of week for weekly)

Items (Optional):
┌─────────────────────────────────────┐
│ Product list if subscription        │
│ includes specific products           │
│ [+ Add Product]                     │
└─────────────────────────────────────┘

Schedule:
- Start Date*: [Date Picker]
- Next Billing Date: [Auto-calculated or manual]
- Trial End Date: [Optional, for trial periods]
- Auto Renew: [✓] Yes [ ] No

Payment:
- Stripe Customer ID: [Auto from prev subscriptions]
- Stripe Subscription ID: [Generated on save]
- Payment Failures: 0 (resets on successful payment)

Status: [Active ▼] [Paused] [Cancelled] [Past Due] [Trialing]

[Save] [Save & Send Welcome Email]
Integration with Stripe: When saving subscription, system calls:

// Backend function: createStripeSubscription
createStripeSubscription({
  customer: {
    email, name, company_id
  },
  subscription: {
    amount, interval, billing_day, items
  }
})

Returns:
{
  stripe_customer_id: "cus_xxx",
  stripe_subscription_id: "sub_xxx",
  next_billing_date: "2024-01-15"
}

Saved to Subscription entity.
Automatic Billing Flow:

Stripe webhook triggered on billing date
Webhook handler receives event
Creates Invoice for the charge
Records BillingHistory entry
If successful: updates next_billing_date
If failed: increments payment_failures, sends alert
Billing History (BillingHistory entity): Tracks every billing attempt:

| Date | Amount | Status | Stripe Invoice | Receipt |
|------|--------|--------|----------------|---------|
| 12/15| $99.99 | Paid   | in_xxx         | [Link]  |
| 11/15| $99.99 | Paid   | in_yyy         | [Link]  |
| 10/15| $99.99 | Failed | in_zzz         | -       |
Failed Payment Handling:

┌─────────────────────────────────────┐
│  Failed Payments (3)                │
├─────────────────────────────────────┤
│  [!] Customer: ABC Corp             │
│      Subscription: Monthly Service  │
│      Failed: Dec 15, 2024           │
│      Reason: Insufficient funds     │
│      Attempts: 2/3                  │
│                                     │
│      [Retry Payment] [Contact]      │
│      [Pause Subscription]           │
├─────────────────────────────────────┤
│  ... more failed payments           │
└─────────────────────────────────────┘
After 3 failures:

Status auto-changes to "past_due"
Admin/customer notified
Access can be restricted (if configured)
Upcoming Charges View: Calendar showing all upcoming billing dates:

┌───────────────────────────────────────────┐
│  January 2025                             │
│  Sun Mon Tue Wed Thu Fri Sat              │
│   1   2   3  [4]  5   6   7  <- 3 bills   │
│   8   9  10  11  12 [13] 14  <- 1 bill    │
│  15 [16] 17  18  19  20  21  <- 5 bills   │
│  ...                                      │
├───────────────────────────────────────────┤
│  Total Expected Revenue: $4,599.95        │
│  [Generate Preview Invoices]              │
└───────────────────────────────────────────┘
5. LOGISTICS SECTION
Manages the physical movement of goods and order fulfillment.

5.1 Orders (AdminOrders.jsx)
Purpose: Complete order lifecycle management from placement to delivery.

Layout:

┌──────────────────────────────────────────────────┐
│  Order Management                                │
│  Filters: [Company] [Status] [Customer]          │
│           [Date Range] [Store] [Driver]          │
├──────────────────────────────────────────────────┤
│  Status Summary (Horizontal Scroll)              │
│  [Pending: 12] [Confirmed: 8] [Out: 15]         │
│  [Delivered: 156] [Cancelled: 3]                 │
├──────────────────────────────────────────────────┤
│  Orders Table                                     │
│  | Order # | Customer | Store | Total |          │
│  | Status | Delivery Date | Driver | Actions |   │
│  ├────────────────────────────────────┤         │
│  │ Drag rows to reorder priority      │         │
│  │ Color-coded by urgency             │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ Create Order] [Bulk Assign] [Export]         │
│  [Print Packing Slips] [Send Notifications]      │
└──────────────────────────────────────────────────┘
Order Status Flow:

Pending 
  ↓
Confirmed (admin/manager approved)
  ↓
Preparing (items being picked/packed)
  ↓
Ready for Pickup (awaiting driver)
  ↓
Out for Delivery (driver has order)
  ↓
Delivered (confirmed by driver)

Alternative paths:
- Pending → Cancelled
- Out for Delivery → Failed Delivery → (reschedule)
Create Order Modal (components/admin/CreateOrderModal.jsx):

┌──────────────────────────────────────────────────┐
│  Create New Order                                │
├──────────────────────────────────────────────────┤
│  Customer Information:                           │
│  Select Existing: [Dropdown ▼]                   │
│  OR Enter New:                                   │
│  - Customer Name*                                │
│  - Phone*                                        │
│  - Email                                         │
├──────────────────────────────────────────────────┤
│  Delivery Information:                           │
│  - Delivery Address*                             │
│  - [Get Coordinates] (geocode button)            │
│  - Latitude: auto-filled                         │
│  - Longitude: auto-filled                        │
│  - Preferred Delivery Time: [Date/Time Picker]   │
├──────────────────────────────────────────────────┤
│  Order Details:                                   │
│  - Company*: [L&M ▼] [My Time]                   │
│  - Store*: [Dropdown filtered by company]        │
│  - Department*: [Dropdown filtered by company]   │
│  - Priority: [Normal ▼] High, Urgent             │
├──────────────────────────────────────────────────┤
│  Order Items:                                     │
│  ┌──────────────────────────────────────────┐   │
│  │ [+ Add Product]                          │   │
│  │ ┌────────────────────────────────────┐   │   │
│  │ │ Product: [Select ▼]                │   │   │
│  │ │ Quantity: [__]                     │   │   │
│  │ │ Price: $__.__ (from product)       │   │   │
│  │ │ Subtotal: $____.__ (calculated)    │   │   │
│  │ │ [Remove]                           │   │   │
│  │ └────────────────────────────────────┘   │   │
│  │ ... more items                           │   │
│  └──────────────────────────────────────────┘   │
│                                                   │
│  Total Amount: $____.__ (auto-calculated)        │
├──────────────────────────────────────────────────┤
│  Notes: (special instructions)                   │
├──────────────────────────────────────────────────┤
│  [Save as Pending] [Save & Confirm] [Cancel]     │
└──────────────────────────────────────────────────┘
Edit Order Form (components/admin/EditOrderForm.jsx): Similar to create, but:

Shows current values
Allows status updates
Can assign to driver/route
Cannot delete items if order is confirmed (must cancel entire order)
Shows change history
Order Actions (Dropdown):

View Details
Edit Order
---
Change Status ▶ [Submenu of statuses]
Assign to Driver ▶ [List of available drivers]
Add to Route ▶ [List of planned routes]
---
Generate Invoice
Send Customer Notification
---
Print Packing Slip
Print Shipping Label
---
Cancel Order (requires confirmation)
Delete Order (only if pending, requires confirmation)
Bulk Actions (components/admin/BulkOrderActions.jsx): Select multiple orders:

Bulk assign to driver
Bulk add to route
Bulk status update
Bulk export (PDF/CSV)
Bulk print packing slips
Geocoding Integration: When address entered:

geocodeAddress(address) {
  // Calls Google Maps Geocoding API or similar
  // Returns { lat, lng }
  // Saved to order.latitude, order.longitude
  // Used for route optimization
}
5.2 Inventory (AdminInventory.jsx)
Purpose: Real-time inventory tracking and stock management.

Key Difference from Products:

Products: Master catalog of what can be sold
Inventory: Current stock levels, locations, transactions
Layout:

┌──────────────────────────────────────────────────┐
│  Inventory Management                            │
│  Filters: [Company] [Store] [Department]         │
│           [Status] [Stock Level] [Category]      │
├──────────────────────────────────────────────────┤
│  Alert Cards                                      │
│  [Critical: 5] [Low Stock: 23] [Overstocked: 8] │
├──────────────────────────────────────────────────┤
│  Inventory Table                                  │
│  | Product | SKU | Location | Stock | Min |      │
│  | Status | Last Updated | Actions |             │
│  ├────────────────────────────────────┤         │
│  │ Color-coded stock levels           │         │
│  │ Editable inline quantities         │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [Adjust Stock] [Transfer] [Bulk Upload]         │
│  [Restock Alert] [Export] [Import Template]      │
└──────────────────────────────────────────────────┘
Stock Level Indicators:

🔴 Critical (0 items): Red badge, urgent icon
🟡 Low Stock (1-min_stock_level): Yellow badge, warning icon
🟢 Adequate (min < stock < max): Green badge
🔵 Overstocked (stock > max_stock_level): Blue badge
Inventory Adjustment Form (components/admin/ProductInventoryForm.jsx):

┌──────────────────────────────────────┐
│  Adjust Inventory                    │
├──────────────────────────────────────┤
│  Product: [Select or scan barcode]  │
│  Current Stock: 45 units             │
├──────────────────────────────────────┤
│  Adjustment Type:                    │
│  ⚪ Add Stock (restock)               │
│  ⚪ Remove Stock (sale, damage)       │
│  ⚪ Set Exact Amount                  │
│  ⚪ Transfer to Another Location      │
├──────────────────────────────────────┤
│  IF Add/Remove:                      │
│  Quantity: [__]                      │
│  New Total: __ units (calculated)    │
│                                      │
│  IF Set Exact:                       │
│  New Amount: [__]                    │
│                                      │
│  IF Transfer:                        │
│  To Location: [Store/Dept dropdown] │
│  Quantity: [__]                      │
├──────────────────────────────────────┤
│  Reason*: [Dropdown]                 │
│  - Restock from vendor               │
│  - Customer purchase                 │
│  - Damaged/expired                   │
│  - Shrinkage/theft                   │
│  - Inventory count correction        │
│  - Transfer                          │
│  - Other (specify)                   │
│                                      │
│  Notes: (optional details)           │
├──────────────────────────────────────┤
│  [Submit Adjustment] [Cancel]        │
└──────────────────────────────────────┘
When submitted, creates InventoryTransaction record:

{
  product_id: "xxx",
  transaction_type: "adjustment",
  quantity_change: +10 or -5,
  previous_quantity: 45,
  new_quantity: 55 or 40,
  reason: "Restock from vendor",
  reference_id: "PO-123" (if linked),
  company_id: "yyy",
  store_id: "zzz",
  created_by: "admin@email.com",
  created_date: timestamp
}
Bulk Inventory Upload (components/admin/BulkInventoryUploadModal.jsx):

┌──────────────────────────────────────┐
│  Bulk Inventory Upload               │
├──────────────────────────────────────┤
│  Step 1: Download Template           │
│  [Download CSV Template]             │
│                                      │
│  Template includes:                  │
│  - Product ID or SKU                 │
│  - Current quantity                  │
│  - New quantity (to update to)       │
├──────────────────────────────────────┤
│  Step 2: Fill Template                │
│  Edit CSV with new quantities        │
├──────────────────────────────────────┤
│  Step 3: Upload Filled Template       │
│  [Drag & Drop or Click to Browse]   │
│  📄 inventory_update.csv             │
├──────────────────────────────────────┤
│  Preview Changes:                    │
│  ┌────────────────────────────────┐ │
│  │ SKU-123: 45 → 60 (+15)         │ │
│  │ SKU-456: 30 → 25 (-5)          │ │
│  │ SKU-789: 0 → 100 (+100)        │ │
│  │ ... 47 more products           │ │
│  └────────────────────────────────┘ │
├──────────────────────────────────────┤
│  [Apply Changes] [Cancel]            │
└──────────────────────────────────────┘
Backend function bulkUpdateInventory processes:

Validates CSV format
Checks product existence
Creates InventoryTransaction for each change
Updates Product.stock_quantity
Returns summary (success/failed count)
Inventory Transaction History: Click on product to see full history:

┌─────────────────────────────────────┐
│  Product: Widget ABC (SKU-123)      │
│  Current Stock: 45 units            │
├─────────────────────────────────────┤
│  Transaction History:               │
│  ┌────────────────────────────────┐│
│  │ Dec 20, 3:00 PM - Admin         ││
│  │ Adjustment: +20 units           ││
│  │ Reason: Restock from vendor     ││
│  │ 25 → 45 units                   ││
│  ├────────────────────────────────┤│
│  │ Dec 18, 11:30 AM - System       ││
│  │ Sale: -5 units                  ││
│  │ Order #ORD-789                  ││
│  │ 30 → 25 units                   ││
│  ├────────────────────────────────┤│
│  │ ... older transactions          ││
│  └────────────────────────────────┘│
└─────────────────────────────────────┘
Restock Alerts: System automatically identifies products needing restock:

needsRestock = products.filter(p => 
  p.stock_quantity <= p.min_stock_level && 
  p.status === 'active'
);

// Can send alerts to:
- Admins (dashboard notification)
- Operations Managers (email)
- Suppliers (auto-generate purchase order)
5.3 Products (AdminProducts.jsx)
Purpose: Master catalog of all sellable items.

Layout:

┌──────────────────────────────────────────────────┐
│  Product Catalog                                 │
│  Filters: [Company] [Category] [Supplier]        │
│           [Status] [Search]                      │
├──────────────────────────────────────────────────┤
│  View Toggle: [Grid View] [Table View]          │
├──────────────────────────────────────────────────┤
│  GRID VIEW:                                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │  [Image] │ │  [Image] │ │  [Image] │        │
│  │  Name    │ │  Name    │ │  Name    │        │
│  │  $19.99  │ │  $29.99  │ │  $9.99   │        │
│  │  Stock:45│ │  Stock:12│ │  Stock:0 │ 🔴     │
│  │  [Edit]  │ │  [Edit]  │ │  [Edit]  │        │
│  └──────────┘ └──────────┘ └──────────┘        │
├──────────────────────────────────────────────────┤
│  [+ Add Product] [Bulk Upload] [Export]          │
│  [Import from QuickBooks] [Sync Inventory]       │
└──────────────────────────────────────────────────┘
Product Form (components/admin/ProductForm.jsx):

┌──────────────────────────────────────────────────┐
│  Product Information                             │
├──────────────────────────────────────────────────┤
│  Basic Info:                                      │
│  - Name*: [__________________________]           │
│  - SKU*: [__________] (unique identifier)        │
│  - Barcode/UPC: [__________] (for scanning)      │
│  - Description: [Text area]                      │
│  - Category*: [Dropdown or custom]               │
├──────────────────────────────────────────────────┤
│  Pricing:                                         │
│  - Selling Price*: $__.__                        │
│  - Cost Price*: $__.__ (for margin calc)         │
│  - Currency: [USD ▼]                             │
├──────────────────────────────────────────────────┤
│  Organization:                                    │
│  - Company*: [L&M ▼]                             │
│  - Department: [Optional dropdown]               │
│  - Primary Store: [Dropdown]                     │
│  - Primary Supplier: [Dropdown from Suppliers]   │
├──────────────────────────────────────────────────┤
│  Inventory Settings:                             │
│  - Unit Type: ⚪ Unit (each) ⚪ Weight (lb/kg)   │
│  - Unit of Measure: [dropdown]                   │
│    Options: each, box, case, lb, kg, oz, etc.   │
│  - Initial Stock: [__] (can edit in inventory)   │
│  - Min Stock Level*: [__] (reorder point)        │
│  - Max Stock Level*: [__] (avoid overstock)      │
│  - Location in Store: [Aisle 5, Shelf B]         │
├──────────────────────────────────────────────────┤
│  Media:                                           │
│  - Product Image:                                │
│    [Drag & Drop or Browse]                       │
│    [Preview thumbnail]                           │
├──────────────────────────────────────────────────┤
│  Status:                                          │
│  ⚪ Active (available for sale)                   │
│  ⚪ Inactive (not available)                      │
│  ⚪ Discontinued (no longer carried)              │
├──────────────────────────────────────────────────┤
│  QuickBooks Integration: (if connected)          │
│  - QuickBooks Item ID: [auto-filled or link]     │
│  - Sync Status: [Synced ✓] [Sync Now]           │
├──────────────────────────────────────────────────┤
│  [Save] [Save & Add Another] [Cancel]            │
└──────────────────────────────────────────────────┘
Bulk Product Upload (components/admin/BulkProductUploadModal.jsx): Similar to inventory bulk upload, but creates new products:

CSV Template columns:
- name*
- sku*
- price*
- cost_price*
- category
- company_id (L&M or My Time ID)
- description
- unit_of_measure
- min_stock_level
- max_stock_level
- initial_stock
- barcode
- supplier (name, looks up Supplier entity)

Process:
1. Download template
2. Fill with product data
3. Upload CSV
4. System creates Product records
5. Links to suppliers by name
6. Creates initial inventory transactions
7. Returns summary report
QuickBooks Sync (components/admin/QuickBooksSync.jsx): If QuickBooks integration is set up:

┌─────────────────────────────────────┐
│  QuickBooks Integration             │
├─────────────────────────────────────┤
│  Status: [Connected ✓]              │
│  Company: L&M Sandbox               │
│  Last Sync: 2 hours ago             │
├─────────────────────────────────────┤
│  Actions:                           │
│  [Sync All Products]                │
│  [Sync New Products Only]           │
│  [Push Local to QuickBooks]         │
├─────────────────────────────────────┤
│  Sync History:                      │
│  Dec 20, 3:00 PM - Success          │
│  45 products synced                 │
│  3 new, 42 updated                  │
└─────────────────────────────────────┘
Backend function quickbooksSync (from functions folder):

Fetches items from QuickBooks API
Matches by SKU or QuickBooks ID
Creates or updates Product records
Stores quickbooks_id for future syncs
Handles rate limiting and errors
5.4 Vendors/Suppliers (AdminVendors.jsx)
Purpose: Manage supplier relationships and procurement.

Layout:

┌──────────────────────────────────────────────────┐
│  Vendor Management                               │
│  Filters: [Company] [Category] [Status]          │
│           [Search]                               │
├──────────────────────────────────────────────────┤
│  Vendor Table                                     │
│  | Name | Contact | Phone | Email | Category |   │
│  | Outstanding Balance | Status | Actions |      │
│  ├────────────────────────────────────┤         │
│  │ Color-coded by payment status      │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ Add Vendor] [Import from QuickBooks]         │
│  [Export] [Send Purchase Orders]                 │
└──────────────────────────────────────────────────┘
Vendor Form (components/admin/VendorForm.jsx):

Basic Info:
- Name*
- Contact Person
- Phone*
- Email*
- Address

Business Details:
- Company Assignment* (L&M, My Time, or shared)
- Category*: food_beverage, equipment, services, office_supplies, other
- Payment Terms: net_15, net_30, net_60, due_on_receipt
- Tax ID (optional)

Financial:
- Outstanding Balance: $_____ (calculated from unpaid vendor payments)
- Credit Limit: $_____ (optional, for spending control)

Status: [Active ▼] [Inactive]

QuickBooks:
- QuickBooks Vendor ID: (auto-filled if synced)

[Save] [Cancel]
Vendor Detail Drawer (components/admin/VendorDrawer.jsx):

┌─────────────────────────────────────┐
│  ← Vendor Name                      │
│  [Edit] [Delete]                    │
├─────────────────────────────────────┤
│  Contact Info:                      │
│  Contact: John Doe                  │
│  Phone: (555) 123-4567              │
│  Email: john@vendor.com             │
│  Address: 123 Main St...            │
├─────────────────────────────────────┤
│  Financial Summary:                 │
│  Outstanding: $2,500.00             │
│  Payment Terms: Net 30              │
│  Total Paid YTD: $45,000            │
├─────────────────────────────────────┤
│  Products Supplied (12):            │
│  - Widget ABC                       │
│  - Gadget XYZ                       │
│  - ...                              │
│  [View All Products]                │
├─────────────────────────────────────┤
│  Recent Payments:                   │
│  Dec 15: $1,200 (Check #1234)       │
│  Nov 30: $2,300 (ACH)               │
│  [View All Transactions]            │
├─────────────────────────────────────┤
│  Actions:                           │
│  [Make Payment] [Create PO]         │
│  [View Statement] [Send Email]      │
└─────────────────────────────────────┘
Vendor Payment Form (components/admin/VendorPaymentForm.jsx):

Vendor*: [Select from Suppliers]
Amount*: $__,___.__
Payment Method*: [Check ▼] ACH, Wire, Card, Cash
Payment Date*: [Date Picker]
Due Date: [Date Picker] (for tracking)
Reference: [Check # or Transaction ID]
Notes: (purpose, invoice numbers)

Linked Invoices: (optional)
[Select invoices this payment covers]

[Record Payment] [Cancel]
Creates VendorPayment record and updates Supplier.outstanding_balance.

5.5 Routes (AdminRoutes.jsx)
Purpose: Plan and optimize delivery routes for efficient logistics.

Layout:

┌──────────────────────────────────────────────────┐
│  Route Planning                                  │
│  Filters: [Date] [Driver] [Status] [Company]     │
├──────────────────────────────────────────────────┤
│  ┌────────────────┐ ┌──────────────────────────┐│
│  │  Route List    │ │  Map View                ││
│  │  (Left Panel)  │ │  (Right Panel, larger)   ││
│  │                │ │                          ││
│  │ [Today's Routes│ │  [Interactive Map]       ││
│  │                │ │  - Starting point        ││
│  │  Dec 20, 2024  │ │  - Delivery stops        ││
│  │  ┌──────────┐  │ │  - Route lines           ││
│  │  │Route A   │  │ │  - Traffic overlay       ││
│  │  │Driver:   │  │ │                          ││
│  │  │John Doe  │  │ │  Distance: 45.2 mi       ││
│  │  │Stops: 12 │  │ │  Duration: 2h 15m        ││
│  │  │Status: ● │  │ │                          ││
│  │  └──────────┘  │ │  [Recalculate Route]     ││
│  │  ... more      │ │  [Export Map PDF]        ││
│  └────────────────┘ └──────────────────────────┘│
├──────────────────────────────────────────────────┤
│  [+ Plan New Route] [Auto-Optimize] [Export]     │
└──────────────────────────────────────────────────┘
Route Planner (components/admin/RoutePlanner.jsx):

┌──────────────────────────────────────────────────┐
│  Plan Delivery Route                             │
├──────────────────────────────────────────────────┤
│  Basic Info:                                      │
│  - Route Name*: [e.g., "Downtown AM Route"]      │
│  - Driver*: [Select Driver ▼]                    │
│  - Support Staff: [Multi-select helpers]         │
│  - Company*: [L&M ▼]                             │
│  - Route Date*: [Date Picker]                    │
│  - Starting Address: [Default: warehouse addr]   │
├──────────────────────────────────────────────────┤
│  Select Orders:                                   │
│  Available Orders (Confirmed, Unassigned):       │
│  ┌──────────────────────────────────────────┐   │
│  │ ☐ Order #123 - ABC Corp                 │   │
│  │   123 Main St, 2.3 mi from start         │   │
│  │   Priority: High                         │   │
│  ├──────────────────────────────────────────┤   │
│  │ ☐ Order #124 - XYZ Inc                  │   │
│  │   456 Oak Ave, 3.1 mi from start         │   │
│  │   Priority: Normal                       │   │
│  ├──────────────────────────────────────────┤   │
│  │ ... more orders                          │   │
│  └──────────────────────────────────────────┘   │
│  [Select All] [Select by Location] [Clear]      │
├──────────────────────────────────────────────────┤
│  Route Optimization:                             │
│  ⚪ Manual Order (drag to reorder stops)          │
│  ⚪ Optimize by Distance (shortest path)          │
│  ⚪ Optimize by Time Window (honor delivery times)│
│  ⚪ Optimize by Priority (high priority first)    │
│                                                   │
│  [Calculate Optimal Route]                       │
├──────────────────────────────────────────────────┤
│  Route Preview:                                   │
│  Total Distance: 45.2 miles                      │
│  Estimated Duration: 2h 15m                      │
│  Number of Stops: 12                             │
│  [View on Map]                                   │
├──────────────────────────────────────────────────┤
│  [Save as Planned] [Save & Assign to Driver]     │
│  [Cancel]                                        │
└──────────────────────────────────────────────────┘
Route Optimization Algorithm:

optimizeRoute(startPoint, orders, optimizationType) {
  switch (optimizationType) {
    case 'distance':
      // Traveling Salesman Problem (TSP)
      // Use nearest neighbor heuristic
      return nearestNeighborTSP(startPoint, orders);
      
    case 'time_window':
      // Consider delivery_time on each order
      // Penalize routes that miss windows
      return timeWindowOptimization(startPoint, orders);
      
    case 'priority':
      // Sort by priority first, then optimize within priority groups
      return priorityBasedOptimization(startPoint, orders);
      
    case 'manual':
      // User drags and reorders, no auto-optimization
      return orders; // as-is
  }
}
Route Map (components/admin/RouteMap.jsx): Uses React-Leaflet:

<MapContainer center={[lat, lng]} zoom={12}>
  <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" />
  
  {/* Starting Point */}
  <Marker position={startPoint} icon={warehouseIcon}>
    <Popup>Start: Warehouse</Popup>
  </Marker>
  
  {/* Each delivery stop */}
  {route.stops.map((stop, index) => (
    <Marker 
      key={stop.id} 
      position={[stop.latitude, stop.longitude]}
      icon={numberIcon(index + 1)}
    >
      <Popup>
        Stop {index + 1}: {stop.customer_name}
        <br/>
        {stop.delivery_address}
        <br/>
        <Link to={createPageUrl(`OrderDetail/${stop.order_id}`)}>
          View Order
        </Link>
      </Popup>
    </Marker>
  ))}
  
  {/* Route polyline */}
  <Polyline 
    positions={route.path} 
    color="blue" 
    weight={3}
  />
</MapContainer>
Route Status Updates: Driver updates via mobile app, admin sees in real-time:

Status: Planned → In Progress → Completed

Each stop status:
- Pending
- Arrived (driver at location)
- Delivered
- Failed

Admin can monitor progress live on map.
Export Route:

PDF: Printable route sheet with:
Map image
Turn-by-turn directions
Stop details (customer, address, phone, items)
Space for signatures
CSV: Stop list with addresses (for GPS import)
Share Link: Send route to driver's phone
6. SUPPORT SECTION
Handles customer issues and internal communication.

6.1 Disputes (AdminDisputes.jsx)
Purpose: Manage customer complaints, delivery issues, and order disputes.

Layout:

┌──────────────────────────────────────────────────┐
│  Dispute Management                              │
│  Filters: [Company] [Type] [Priority] [Status]   │
│           [Assigned To] [Date Range]             │
├──────────────────────────────────────────────────┤
│  Priority Dashboard                               │
│  [Critical: 2] [High: 8] [Medium: 15] [Low: 5]  │
├──────────────────────────────────────────────────┤
│  Disputes Table                                   │
│  | Title | Customer | Type | Priority | Status | │
│  | Assigned To | Due Date | Actions |            │
│  ├────────────────────────────────────┤         │
│  │ Color-coded by priority & overdue  │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [+ Log Dispute] [Bulk Assign] [Export]          │
│  [Send Notifications] [Close Resolved]           │
└──────────────────────────────────────────────────┘
Dispute Types:

Late Delivery
Missing Items
Damaged Goods
Wrong Product
Pricing Issue
Other (with description)
Priority Levels:

Critical: Safety issue, major financial loss, legal threat
High: Angry customer, multiple issues, high-value order
Medium: Standard complaint, resolvable
Low: Minor issue, informational
Dispute Form (components/admin/DisputeForm.jsx):

┌──────────────────────────────────────────────────┐
│  Log New Dispute                                 │
├──────────────────────────────────────────────────┤
│  Customer Information:                           │
│  - Customer Name*                                │
│  - Phone*                                        │
│  - Email                                         │
│  - Related Order: [Select Order ▼] (optional)    │
├──────────────────────────────────────────────────┤
│  Dispute Details:                                │
│  - Title*: [Brief summary]                       │
│  - Type*: [Late Delivery ▼]                      │
│    If "Other": [Specify ________]                │
│  - Company*: [L&M ▼]                             │
├──────────────────────────────────────────────────┤
│  Classification:                                  │
│  - Priority*: [Medium ▼] Low, High, Critical     │
│  - Due Date: [Date Picker] (resolution deadline) │
│  - Assign To: [Select Staff ▼] (optional)        │
├──────────────────────────────────────────────────┤
│  Description*: [Text area - detailed explanation]│
├──────────────────────────────────────────────────┤
│  Evidence:                                        │
│  [Upload Photos/Documents]                       │
│  📷 damaged_product.jpg                          │
│  📄 receipt.pdf                                  │
│  [+ Add More]                                    │
├──────────────────────────────────────────────────┤
│  Internal Notes: (not visible to customer)       │
│  [Text area]                                     │
├──────────────────────────────────────────────────┤
│  Visibility:                                      │
│  ⚪ Full Team (all staff can see)                 │
│  ⚪ Manager Only (ops managers + admins)          │
│  ⚪ Admin Only (admins only)                      │
├──────────────────────────────────────────────────┤
│  Tags: (for filtering/reporting)                 │
│  [+ Add Tag] [delivery] [refund] [quality]       │
├──────────────────────────────────────────────────┤
│  [Save as Open] [Save & Notify Customer] [Cancel]│
└──────────────────────────────────────────────────┘
Dispute Detail Modal (components/admin/DisputeDetailModal.jsx):

┌──────────────────────────────────────────────────┐
│  Dispute #DIS-123                        [Edit]  │
│  [Critical Priority Badge] [Open Status]         │
├──────────────────────────────────────────────────┤
│  Customer: John Doe                              │
│  Phone: (555) 123-4567                           │
│  Email: john@example.com                         │
│  Order: #ORD-456                                 │
├──────────────────────────────────────────────────┤
│  Title: "Missing items from delivery"           │
│  Type: Missing Items                             │
│  Created: Dec 18, 2024 10:30 AM                  │
│  Due: Dec 25, 2024                               │
│  Assigned: Jane Smith (Operations Manager)       │
├──────────────────────────────────────────────────┤
│  Description:                                     │
│  "Customer ordered 10 boxes of Product X but     │
│   only received 7. Requesting 3 missing boxes    │
│   or refund."                                    │
├──────────────────────────────────────────────────┤
│  Evidence:                                        │
│  [Thumbnail] delivery_photo.jpg                  │
│  [Thumbnail] order_receipt.pdf                   │
│  [View All]                                      │
├──────────────────────────────────────────────────┤
│  Internal Notes:                                  │
│  "Verified with driver - short shipment from     │
│   warehouse. Need to deliver 3 boxes ASAP."      │
│  - Added by Jane Smith, Dec 18, 11:00 AM         │
├──────────────────────────────────────────────────┤
│  Resolution Notes:                                │
│  [Text area for admin to document solution]      │
├──────────────────────────────────────────────────┤
│  Timeline:                                        │
│  ┌────────────────────────────────────────┐     │
│  │ Dec 18, 10:30 AM - Dispute created     │     │
│  │ Dec 18, 11:00 AM - Assigned to Jane    │     │
│  │ Dec 18, 11:15 AM - Status: In Review   │     │
│  │ Dec 18, 2:00 PM - Note added by Jane   │     │
│  └────────────────────────────────────────┘     │
├──────────────────────────────────────────────────┤
│  Actions:                                         │
│  [Change Status ▼]                               │
│    - Open                                        │
│    - In Review                                   │
│    - Escalated                                   │
│    - Resolved                                    │
│    - Closed                                      │
│                                                   │
│  [Reassign] [Add Note] [Upload Evidence]         │
│  [Send Update to Customer] [Mark Resolved]       │
│  [Close Dispute]                                 │
└──────────────────────────────────────────────────┘
Bulk Actions (components/admin/BulkDisputeActions.jsx): Select multiple disputes:

Bulk assign to staff member
Bulk change priority
Bulk change status
Bulk add tag
Bulk export for reporting
Dispute Analytics: Dashboard shows:

Average resolution time
Disputes by type (pie chart)
Disputes by priority over time
Top customers with disputes
Staff performance (assigned vs resolved)
6.2 Chat (AdminChat.jsx)
Purpose: Internal team communication and collaboration.

Layout:

┌──────────────────────────────────────────────────┐
│  ┌────────────┐ ┌──────────────────────────────┐│
│  │  Sidebar   │ │  Message Pane                ││
│  │  (Channels)│ │                              ││
│  │            │ │  [Channel Name]     [Mem▼]  ││
│  │  + New Chat│ │  ────────────────────────────││
│  │            │ │                              ││
│  │  Direct:   │ │  [Messages scroll area]      ││
│  │  • John    │ │                              ││
│  │  • Mary    │ │  John: Hey team...           ││
│  │  • Bob     │ │  (10:30 AM)                  ││
│  │            │ │                              ││
│  │  Groups:   │ │  You: Working on it          ││
│  │  # General │ │  (10:32 AM)                  ││
│  │  # Ops     │ │                              ││
│  │  # Drivers │ │  ...                         ││
│  │            │ │  ────────────────────────────││
│  │            │ │  [Type message...] [Send]    ││
│  └────────────┘ └──────────────────────────────┘│
└──────────────────────────────────────────────────┘
Chat Sidebar (components/admin/chat/ChatSidebar.jsx):

Search: [Find conversations...]

[+ New Message] [+ New Channel]

Direct Messages:
  • John Doe        "Thanks!"     2m
  • Mary Smith      "On my way"   10m
  ● Jane Admin      "Check this"  1h  <- unread (dot)

Channels:
  # General         "Welcome!"    2h
  # Operations      "Route upd..."5h
  # Drivers         "Need help"   1d
  # L&M Only        "Meeting..."  2d
Message Pane (components/admin/chat/MessagePane.jsx): Divided into:

Header (components/admin/chat/ChatHeader.jsx):
# Channel Name / User Name
[Members: 12] [Settings] [Search in convo]
Message List (components/admin/chat/MessageList.jsx):
┌────────────────────────────────────┐
│ [Avatar] John Doe    10:30 AM      │
│ Hey team, route update needed for  │
│ tomorrow's deliveries.             │
│                                    │
│ [Avatar] You         10:32 AM      │
│ Working on it. Will have it ready  │
│ by end of day.                     │
│                                    │
│ ... older messages ...             │
│                                    │
│ ─────── Dec 19, 2024 ──────       │
│                                    │
│ [Avatar] Mary Smith   3:00 PM      │
│ Route is optimized. 12 stops, 2h.  │
│ [View Route Link]                  │
└────────────────────────────────────┘
Message Composer (components/admin/chat/MessageComposer.jsx):
┌────────────────────────────────────┐
│ [Type your message...]             │
│                                    │
│ [📎] [😊] [Send]                   │
└────────────────────────────────────┘
Features:
Rich text (bold, italic, links)
File attachments
Emoji picker
@mentions (autocomplete users)
Send on Enter
Creating Channels: New Channel Modal (components/admin/chat/NewChannelModal.jsx):

┌─────────────────────────────────────┐
│  Create New Channel                 │
├─────────────────────────────────────┤
│  Channel Type:                      │
│  ⚪ Direct Message (1-on-1)          │
│  ⚪ Group Channel (multiple members) │
├─────────────────────────────────────┤
│  IF Direct Message:                 │
│  Select User: [Dropdown]            │
│                                     │
│  IF Group:                          │
│  Channel Name*: [e.g., "Logistics"] │
│  Members*: [Multi-select users]     │
│  ☑ John Doe                         │
│  ☑ Mary Smith                       │
│  ☐ Bob Johnson                      │
│  ...                                │
├─────────────────────────────────────┤
│  Company Scope: [L&M ▼] My Time    │
│  (filters available members)        │
├─────────────────────────────────────┤
│  [Create Channel] [Cancel]          │
└─────────────────────────────────────┘
Channel Settings: Click settings icon in chat header: Edit Channel Modal (components/admin/chat/EditChannelModal.jsx):

┌─────────────────────────────────────┐
│  Channel Settings                   │
├─────────────────────────────────────┤
│  Name: [Logistics Team]             │
│  Description: [For logistics coord] │
├─────────────────────────────────────┤
│  Members (5):                       │
│  • John Doe      [Remove]           │
│  • Mary Smith    [Remove]           │
│  • Jane Admin    [Remove]           │
│  • Bob Driver    [Remove]           │
│  • You (Admin)   [Leave Channel]    │
│                                     │
│  [+ Add Members]                    │
├─────────────────────────────────────┤
│  Notifications:                     │
│  ⚪ All messages                     │
│  ⚪ @mentions only                   │
│  ⚪ Muted                            │
├─────────────────────────────────────┤
│  Danger Zone:                       │
│  [Delete Channel] (archive all msgs)│
├─────────────────────────────────────┤
│  [Save Changes] [Cancel]            │
└─────────────────────────────────────┘
Message Features:

Editing: Click message, edit, save (marked as "edited")
Deleting: Right-click → Delete → Confirm
Reactions: Emoji reactions on messages (👍 ❤️ 😂)
Threading: Reply to specific message (shows thread)
Search: Search within conversation or all messages
Real-Time Updates:

Uses polling (every 2 seconds) to fetch new messages
Unread count updates in sidebar
Notification badge on layout navigation item
Desktop notifications (if permitted)
Data Model:

Channel Entity:
- name (for groups)
- type: "dm" or "group"
- memberIds: [array of user IDs]
- company_id

Message Entity:
- channel_id
- sender_id
- text
- status: "sent", "edited", "deleted"
- created_date

Unread Tracking:
- Client-side: Compare last_read_timestamp with message timestamps
- Server could store last_read per user/channel for accuracy
7. SYSTEM SECTION
Administrative and security functions.

7.1 Settings (AdminSettings.jsx)
Purpose: Configure system-wide settings, integrations, and preferences.

Layout:

┌──────────────────────────────────────────────────┐
│  System Settings                                 │
├──────────────────────────────────────────────────┤
│  Tabs:                                            │
│  [General] [Integrations] [Notifications]        │
│  [Security] [Billing]                            │
├──────────────────────────────────────────────────┤
│  GENERAL TAB:                                    │
│  ┌────────────────────────────────────────┐     │
│  │ Application Name: [TimeFlow Ops]       │     │
│  │ Default Language: [English ▼]          │     │
│  │ Default Currency: [USD ▼]              │     │
│  │ Timezone: [America/New_York ▼]         │     │
│  │ Date Format: [MM/DD/YYYY ▼]            │     │
│  │ Time Format: [12-hour ▼]               │     │
│  └────────────────────────────────────────┘     │
│  [Save Settings]                                 │
└──────────────────────────────────────────────────┘
Integrations Tab:

┌──────────────────────────────────────────────────┐
│  Third-Party Integrations                        │
├──────────────────────────────────────────────────┤
│  QuickBooks:                                      │
│  Status: [Connected ✓] L&M Sandbox               │
│  [Disconnect] [Setup]                            │
│  ─────────────────────────────────────────────   │
│  Stripe (Payment Processing):                    │
│  Status: [Connected ✓]                           │
│  Public Key: pk_live_xxx (hidden)                │
│  [Update Keys] [Test Connection]                 │
│  ─────────────────────────────────────────────   │
│  SMTP (Email):                                    │
│  Status: [Not Configured]                        │
│  [Configure SMTP Settings]                       │
│  ─────────────────────────────────────────────   │
│  Zapier (Automation):                            │
│  Status: [Not Connected]                         │
│  [Get Webhook URL] [Setup Zaps]                  │
│  ─────────────────────────────────────────────   │
│  Google Maps (Geocoding & Routing):              │
│  Status: [Active]                                │
│  API Key: AIza... (hidden)                       │
│  [Update Key]                                    │
└──────────────────────────────────────────────────┘
Each integration has a modal: QuickBooks Setup Modal (components/admin/QuickBooksSetupModal.jsx):

┌─────────────────────────────────────┐
│  QuickBooks Integration Setup       │
├─────────────────────────────────────┤
│  Step 1: Enter Credentials          │
│  Client ID*: [____________________] │
│  Client Secret*: [________________] │
│                                     │
│  [Where to find these?] (help link) │
├─────────────────────────────────────┤
│  Step 2: Connect to QuickBooks      │
│  Select Company: [L&M ▼] My Time    │
│  [Authorize with QuickBooks]        │
│  (Opens OAuth flow)                 │
├─────────────────────────────────────┤
│  Step 3: Configure Sync             │
│  Auto-sync: ☑ Products              │
│             ☑ Customers              │
│             ☑ Vendors                │
│  Sync Frequency: [Daily ▼]          │
│  Conflict Resolution: [QB wins ▼]   │
├─────────────────────────────────────┤
│  [Save & Connect] [Cancel]          │
└─────────────────────────────────────┘
SMTP Modal (components/admin/integrations/SmtpModal.jsx):

SMTP Server*: [smtp.gmail.com]
Port*: [587]
Username*: [your-email@gmail.com]
Password*: [app-password]
From Name: [TimeFlow Operations]

[Test Connection] [Save]
Zapier Modal (components/admin/integrations/ZapierModal.jsx):

Your Webhook URL:
https://functions.base44.app/.../zapierWebhook

Use this URL in your Zap as a Webhook trigger.

Events Available:
- order.created
- order.delivered
- invoice.paid
- dispute.opened

[Copy URL] [View Documentation]
Notifications Tab:

Email Notifications:
☑ Order confirmations to customers
☑ Delivery updates to customers
☑ Failed delivery alerts to admins
☑ Low stock alerts to ops managers
☑ Dispute notifications to assigned staff
☑ Payroll reminders to admins

SMS Notifications:
☐ Delivery ETA to customers (requires Twilio)
☐ Driver assignment alerts

Push Notifications:
☑ New chat messages
☑ Urgent disputes
☐ Route updates
Security Tab:

Password Policy:
☑ Minimum 8 characters
☑ Require uppercase and lowercase
☑ Require numbers
☐ Require special characters
Password Expiry: [Never ▼] 30/60/90 days

Session Management:
Idle Timeout: [30 minutes ▼]
Max Concurrent Sessions: [3 ▼]

Two-Factor Authentication:
Status: [Optional ▼] Required, Disabled
Supported Methods: ☑ Email ☑ SMS ☐ Authenticator App

IP Whitelisting:
☐ Enable IP restrictions
Allowed IPs: [Add IP ranges]

[Save Security Settings]
Billing Tab (if app uses paid features):

Current Plan: Professional
Monthly Cost: $199/month
Billing Cycle: Renews Jan 15, 2025

Usage This Month:
- Users: 25/50
- Storage: 12 GB / 100 GB
- API Calls: 45,000 / 100,000

Payment Method:
Visa ****1234 (Expires 12/25)
[Update Payment Method]

[View Invoices] [Change Plan] [Cancel Subscription]
7.2 User Logs (AdminUserLogs.jsx)
Purpose: Comprehensive audit trail of all user actions for security and compliance.

Layout:

┌──────────────────────────────────────────────────┐
│  User Activity Logs                              │
│  Filters: [User] [Action Type] [Entity]          │
│           [Status] [Date Range] [IP Address]     │
├──────────────────────────────────────────────────┤
│  Summary:                                         │
│  Today: 1,234 actions | Week: 8,567 | Month: ...│
│  Failed Actions Today: 5                         │
├──────────────────────────────────────────────────┤
│  Logs Table                                       │
│  | Timestamp | User | Action | Entity | Status | │
│  | IP Address | Details |                        │
│  ├────────────────────────────────────┤         │
│  │ Real-time feed of all actions      │         │
│  │ Color-coded by action type         │         │
│  └────────────────────────────────────┘         │
├──────────────────────────────────────────────────┤
│  [Export Logs] [Generate Compliance Report]      │
│  [Set Alert Rules]                               │
└──────────────────────────────────────────────────┘
Log Entry Example:

Timestamp: Dec 20, 2024 3:45:32 PM
User: jane@lm.com (Jane Smith - Admin)
Action: update
Entity: Product
Entity ID: prod_123
Status: success

State Before:
{
  "name": "Widget ABC",
  "price": 19.99,
  "stock_quantity": 45
}

State After:
{
  "name": "Widget ABC Pro",
  "price": 24.99,
  "stock_quantity": 45
}

IP Address: 192.168.1.100
User Agent: Mozilla/5.0...
Metadata: {
  "reason": "Price update per management"
}
Action Types Logged:

login_success/login_fail: User authentication attempts
logout: Session ends
create: New record created
update: Record modified
delete: Record deleted
permission_change: Role or access modified
export: Data exported from system
Log Detail Drawer (components/admin/logs/UserLogDetailsDrawer.jsx):

┌──────────────────────────────────────┐
│  ← Log Entry Details                 │
├──────────────────────────────────────┤
│  Dec 20, 2024 3:45:32 PM             │
│  User: Jane Smith (jane@lm.com)      │
│  Role at time: Admin                 │
│  IP: 192.168.1.100                   │
│  User Agent: Chrome 120.0 on Windows │
├──────────────────────────────────────┤
│  Action: Product Update              │
│  Entity: Product (prod_123)          │
│  Status: ✓ Success                   │
├──────────────────────────────────────┤
│  Changes Made:                       │
│  ┌────────────────────────────────┐ │
│  │ Field: name                    │ │
│  │ Before: "Widget ABC"           │ │
│  │ After: "Widget ABC Pro"        │ │
│  ├────────────────────────────────┤ │
│  │ Field: price                   │ │
│  │ Before: 19.99                  │ │
│  │ After: 24.99                   │ │
│  └────────────────────────────────┘ │
├──────────────────────────────────────┤
│  Metadata:                           │
│  Reason: "Price update per mgmt"     │
├──────────────────────────────────────┤
│  [Flag as Suspicious] [Export]       │
└──────────────────────────────────────┘
Filters (components/admin/logs/UserLogFilters.jsx):

User: [All Users ▼]
  (Dropdown with search)

Action Type: [All Actions ▼]
  Login, Logout, Create, Update, Delete, Export, Permission Change

Entity: [All Entities ▼]
  Product, Order, Invoice, User, etc.

Status: [All Statuses ▼]
  Success, Failure

Date Range: [Last 7 Days ▼]
  Today, Yesterday, Last 7/30/90 days, Custom Range

IP Address: [Any IP] or [Specific IP input]

[Apply Filters] [Reset]
Suspicious Activity Detection: System flags potential security issues:

Multiple failed login attempts
Access from unusual IP address
Mass deletions
Permission escalation
After-hours access to sensitive data
Rapid succession of similar actions (potential automation)
Admins receive alerts:

⚠️ Suspicious Activity Detected
User: john@lm.com
Activity: 15 failed login attempts in 5 minutes
IP: 45.123.456.789 (New location: Russia)
Time: Dec 20, 2024 2:30 AM

[Review Logs] [Block User] [Dismiss]
Compliance Reports: Generate audit reports for:

SOX compliance (financial record access)
GDPR (data access and modifications)
HIPAA (if handling sensitive data)
Internal audit requirements
Report includes:

Date range
All actions by user type
Changes to financial records
Data exports
Permission changes
Security events
Export Options:

CSV: For Excel analysis
PDF: Formatted report
JSON: For programmatic processing
Syslog Format: For SIEM integration
Key Workflows
Workflow 1: Creating and Fulfilling an Order
1. Admin → Orders → Create Order
2. Fill customer info, add products, set delivery details
3. Save as "Pending"
4. Admin → Orders → Edit Order → Change status to "Confirmed"
5. System generates Invoice automatically
6. Admin → Routes → Plan Route
7. Select confirmed orders, assign driver, optimize route
8. Save route as "Planned"
9. Driver sees route on mobile app (Staff Dashboard)
10. Driver updates each stop status during delivery
11. Admin monitors progress on Route Map (live)
12. Driver marks order "Delivered" with proof (signature/photo)
13. Admin → Invoices → Mark invoice as "Paid" (if cash collected)
14. System creates LedgerEntry (income) in Bookkeeping
15. Order complete ✓
Workflow 2: Managing Inventory Shortage
1. System detects: Product X stock = 5, min = 10
2. Dashboard shows "Low Stock Alert" in Shrinkage Alerts card
3. Admin clicks alert → redirected to Inventory page, filtered for low stock
4. Admin → Inventory → Click on Product X
5. Clicks "Adjust Stock" → "Add Stock (restock)"
6. Enters quantity: +50
7. Reason: "Restock from Vendor ABC"
8. System creates InventoryTransaction
9. Product X stock now = 55
10. Alert disappears from dashboard
11. (Optional) Admin → Vendors → Vendor ABC → "Make Payment"
12. Records payment for restock purchase
13. Creates VendorPayment and LedgerEntry (expense)
Workflow 3: Handling a Dispute
1. Customer calls: "Missing items in Order #ORD-123"
2. Admin → Disputes → Log Dispute
3. Fills form:
   - Customer: John Doe
   - Type: Missing Items
   - Priority: High
   - Description: "3 boxes short"
   - Uploads photo from customer
4. Assigns to Operations Manager Mary
5. Mary receives notification
6. Mary → Disputes → Opens dispute #DIS-456
7. Adds internal note: "Verified with driver, warehouse short-shipped"
8. Changes status to "In Review"
9. Mary coordinates with warehouse: send 3 boxes via next route
10. Mary adds resolution note: "3 boxes delivered Dec 21"
11. Mary changes status to "Resolved"
12. Admin reviews, confirms with customer
13. Admin changes status to "Closed"
14. System logs all actions in UserLogs
Workflow 4: Generating Payroll
1. Admin → Payroll → Select pay period (Dec 1-15)
2. Clicks "Bulk Generate"
3. System fetches all active employees
4. For each employee:
   - Calculates hours from Schedule entity (if tracked)
   - Or prompts admin to enter hours manually
5. System calculates:
   - Gross pay (hours × rate)
   - Deductions (taxes, insurance)
   - Net pay
6. Creates PayrollEntry for each employee (status: pending)
7. Admin reviews entries in table
8. Clicks "Approve All" or individually approves each
9. Status changes to "approved"
10. Admin processes payments (external payroll system or manual)
11. Admin marks entries as "paid"
12. System creates LedgerEntry for total payroll expense
13. Employees can view their payroll in Staff Dashboard (if implemented)
Workflow 5: QuickBooks Synchronization
1. Admin → Settings → Integrations → QuickBooks
2. Enters Client ID and Client Secret
3. Clicks "Authorize with QuickBooks"
4. OAuth flow: redirects to QuickBooks login
5. User authorizes app access
6. Returns to app with access token
7. Admin → Products → QuickBooks Sync button
8. Backend function `quickbooksSync` is called
9. Function fetches Items from QuickBooks API
10. For each QB Item:
    - Checks if Product exists (by SKU or QB ID)
    - If exists: updates Product record
    - If not: creates new Product record
    - Stores quickbooks_id for future syncs
11. Returns summary: "45 products synced, 3 new, 42 updated"
12. Admin sees success notification
13. Products now reflect QuickBooks data
14. Future syncs are incremental (only changed items)
Permissions & Security
Role-Based Access Control (RBAC)
Admin (app_role: 'admin'):

Full Access: Can view, create, edit, delete all data
System Configuration: Can change settings, integrations
User Management: Can invite users, assign roles
Financial Data: Can view and modify all financial records
Override Permissions: Can bypass normal restrictions
Operations Manager (app_role: 'operations_manager'):

Operational Data: Can manage orders, routes, inventory, disputes
Limited Financial: Can view invoices, but cannot edit (must request)
Staff Management: Can view and manage operational staff
No System Settings: Cannot change integrations or system configs
Company-Scoped: Can be restricted to specific companies
Department Manager (app_role: 'department_manager'):

Order Placement: Can create orders for their department
View History: Can see their department's order history
Raise Disputes: Can log disputes for their orders
No Access: Cannot see other departments, inventory, routes, or financials
Delivery Staff (app_role: 'delivery_staff'):

Own Routes Only: Can only see routes assigned to them
Own Orders: Can view and update orders on their routes
Payment Collection: Can record cash/check payments
Expense Tracking: Can log their own expenses
No Access: Cannot see other drivers, manage inventory, or view financials
Row-Level Security (RLS)
Entities have RLS rules defined in their schema:

"rls": {
  "read": {
    "user_condition": {
      "role": { "$in": ["admin", "operations_manager"] }
    }
  },
  "write": {
    "user_condition": {
      "role": "admin"
    }
  }
}
Examples:

Invoice: Only admins and ops managers can read, only admins can write
LedgerEntry: Only admins can read/write
PayrollEntry: Only admins can modify, ops managers can view
User: Users can view/edit their own record, admins can view/edit all
Route: Delivery staff see only their assigned routes, admins see all
Data Filtering
When operations managers query data, results are automatically filtered by:

Company Assignment: Only see data for companies they manage (based on user.company_filter)
Department/Store: If assigned to specific dept/store, only see that data
Admin portal respects company toggle at the top:

If "L&M" selected: Only show L&M data
If "My Time" selected: Only show My Time data
If "Both" selected: Show all data
Security Best Practices Implemented
Authentication: All API calls require valid JWT token
Authorization: Every action checked against user's role
Audit Logging: All modifications logged in UserLog entity
Encryption: Sensitive data (passwords, API keys) encrypted at rest
HTTPS Only: All traffic over secure connections
Rate Limiting: API calls rate-limited to prevent abuse
Input Validation: All form inputs validated client and server-side
SQL Injection Prevention: Using parameterized queries, ORM
XSS Prevention: React automatically escapes output
CSRF Protection: Tokens used for state-changing operations
Data Relationships
Core Entity Graph
Company
  ├─ has many Stores
  ├─ has many Departments
  ├─ has many Users (via user.company_id)
  ├─ has many Products
  ├─ has many Orders
  ├─ has many Invoices
  └─ has many Suppliers

Store
  ├─ belongs to Company
  ├─ has many Orders (store_id)
  ├─ has many Products (primary store)
  └─ has many Users (assigned store)

Department
  ├─ belongs to Company (or shared)
  ├─ has many Orders
  └─ has many Users

User
  ├─ belongs to Company (optional)
  ├─ belongs to Department (optional)
  ├─ belongs to Store (optional)
  ├─ has many Routes (as driver)
  ├─ has many PayrollEntries
  ├─ has many UserLogs
  └─ has many Messages (as sender)

Product
  ├─ belongs to Company
  ├─ belongs to Department (optional)
  ├─ belongs to Store (primary)
  ├─ belongs to Supplier (primary)
  ├─ has many InventoryTransactions
  └─ appears in many OrderItems

Order
  ├─ belongs to Company
  ├─ belongs to Store
  ├─ belongs to Department
  ├─ assigned to Driver (User)
  ├─ has many OrderItems (products + quantities)
  ├─ has one Invoice
  
39 minutes ago
continue where you left off

30 minutes ago
•
see context
Revert this
Base44 AI
Base44

Thought for 1s
Order (continued)
  ├─ has one Invoice
  ├─ belongs to Route (optional)
  ├─ has many DeliveryLogs
  └─ may have Disputes

Invoice
  ├─ belongs to Order
  ├─ belongs to Company
  ├─ belongs to Store
  ├─ belongs to Department
  ├─ has one Customer reference
  ├─ creates LedgerEntry when paid
  └─ may have InvoiceEditRequests

Route
  ├─ belongs to Company
  ├─ assigned to Driver (User)
  ├─ has many support_staff_ids (Users)
  ├─ has many Orders (order_ids array)
  └─ has many DeliveryLogs

Dispute
  ├─ belongs to Company
  ├─ linked to Order (optional)
  ├─ assigned to User (staff member)
  └─ has resolution history

Supplier/Vendor
  ├─ belongs to Company
  ├─ supplies many Products
  ├─ has many VendorPayments
  └─ creates LedgerEntries (expenses)

LedgerEntry (Central Financial Record)
  ├─ belongs to Company
  ├─ may reference Order (for income)
  ├─ may reference Invoice (for income)
  ├─ may reference Expense (for expenses)
  ├─ may reference VendorPayment (for expenses)
  ├─ may reference PayrollEntry (for expenses)
  └─ tracks all financial transactions

Subscription (Recurring Billing)
  ├─ belongs to Company
  ├─ belongs to Store
  ├─ belongs to Department
  ├─ assigned to department_manager_id (User)
  └─ has many BillingHistory records

BillingHistory
  ├─ belongs to Subscription
  ├─ belongs to Company
  └─ creates Invoice on successful billing

Channel (Chat)
  ├─ belongs to Company
  ├─ has many memberIds (Users)
  └─ has many Messages

Message
  ├─ belongs to Channel
  └─ sent by User (sender_id)

InventoryTransaction
  ├─ belongs to Product
  ├─ belongs to Company
  ├─ belongs to Store (optional)
  ├─ belongs to Department (optional)
  └─ created by User

PayrollEntry
  ├─ belongs to Company
  ├─ belongs to Department
  ├─ for User (employee)
  ├─ creates LedgerEntry when paid
  └─ approved by User (admin)

UserLog (Audit Trail)
  ├─ belongs to Company
  ├─ created by User
  ├─ references any Entity (polymorphic)
  └─ tracks state changes
Cascade Behaviors
When deleting a Company:

Soft delete or prevent if has orders/invoices (data integrity)
Transfer users to another company or deactivate
Archive all related data
When deleting a User:

Cannot delete if has unresolved assigned items
Reassign: Orders, Routes, Disputes to another user
Preserve: UserLogs (for audit trail)
Anonymize: Messages (replace with "Deleted User")
When deleting an Order:

Can only delete if status = "pending" or "cancelled"
If has Invoice: must void invoice first
If on Route: must remove from route first
Preserve: OrderItems for reporting
Create: UserLog entry for deletion
When deleting a Product:

Cannot delete if has pending orders
Can mark as "discontinued" instead
Preserve: InventoryTransactions (history)
Update: OrderItems to show product name (snapshot)
Advanced Features
1. Multi-Company Management
The admin portal is designed to seamlessly handle multiple companies (L&M and My Time).

Company Toggle Implementation:

// Layout component state
const [currentCompanyFilter, setCurrentCompanyFilter] = useState(['all']);

// Event system for company changes
window.addEventListener('companyFilterChanged', (event) => {
  const { companies } = event.detail;
  // Update all data tables, charts, and queries
  reloadDashboardData(companies);
});

// Filtering logic in data fetches
const loadOrders = async (companyFilter) => {
  let filter = {};
  if (!companyFilter.includes('all')) {
    filter.company_id = { $in: companyFilter };
  }
  const orders = await Order.filter(filter);
  // Process orders...
};
Visual Indicators:

Company logo changes based on selection
Theme colors can adjust per company (L&M = blue, My Time = green)
Branding persists across all pages
User preference saved and restored on login
Cross-Company Operations:

Transfers between companies (inventory, funds)
Shared products (where company_id is null)
Consolidated reports (both companies combined)
Comparison analytics (L&M vs My Time performance)
2. Real-Time Updates & Notifications
Polling Strategy:

// Dashboard component
useEffect(() => {
  const pollInterval = setInterval(() => {
    loadDashboardData();
  }, 30000); // Poll every 30 seconds
  
  return () => clearInterval(pollInterval);
}, []);

// Chat component
useEffect(() => {
  const pollInterval = setInterval(() => {
    fetchNewMessages();
  }, 2000); // Poll every 2 seconds for messages
  
  return () => clearInterval(pollInterval);
}, [currentChannelId]);
Notification Badge System:

// Layout component
const [unreadMessages, setUnreadMessages] = useState(0);

// Update badge on navigation item
<NavItem 
  item={{ title: "Chat", icon: MessageCircle, url: "AdminChat" }}
  unreadCount={unreadMessages}
/>

// Badge rendering
{unreadCount > 0 && (
  <span className="badge">
    {unreadCount > 99 ? '99+' : unreadCount}
  </span>
)}
Alert Types:

Info (blue): General notifications
Warning (yellow): Action may be needed
Error (red): Critical issues requiring immediate attention
Success (green): Confirmation of completed actions
Toast Notifications:

import { toast } from "@/components/ui/use-toast";

// Success
toast({ 
  title: "Order Created", 
  description: "Order #ORD-123 has been created successfully" 
});

// Error
toast({ 
  title: "Failed to Save", 
  description: "Network error. Please try again.", 
  variant: "destructive" 
});

// With action
toast({
  title: "Invoice Generated",
  description: "Invoice #INV-456 ready to send",
  action: <Button onClick={sendInvoice}>Send Now</Button>
});
3. Advanced Filtering & Search
Filter Component Pattern:

// Generic filter component
function DataFilters({ onFilterChange, filters }) {
  const [localFilters, setLocalFilters] = useState(filters);
  
  const handleFilterChange = (key, value) => {
    const updated = { ...localFilters, [key]: value };
    setLocalFilters(updated);
    onFilterChange(updated);
  };
  
  return (
    <Card className="mb-4 p-4">
      <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <Input
          placeholder="Search..."
          value={localFilters.search}
          onChange={(e) => handleFilterChange('search', e.target.value)}
        />
        
        <Select
          value={localFilters.status}
          onValueChange={(value) => handleFilterChange('status', value)}
        >
          <SelectTrigger>
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Statuses</SelectItem>
            <SelectItem value="active">Active</SelectItem>
            <SelectItem value="inactive">Inactive</SelectItem>
          </SelectContent>
        </Select>
        
        {/* More filters... */}
        
        <Button variant="outline" onClick={() => {
          setLocalFilters(initialFilters);
          onFilterChange(initialFilters);
        }}>
          Reset Filters
        </Button>
      </div>
    </Card>
  );
}
Search Implementation:

// Client-side search (for small datasets)
const filteredData = data.filter(item => {
  const searchLower = searchTerm.toLowerCase();
  return (
    item.name.toLowerCase().includes(searchLower) ||
    item.email.toLowerCase().includes(searchLower) ||
    item.phone.includes(searchTerm)
  );
});

// Server-side search (for large datasets)
const searchResults = await Entity.filter({
  $or: [
    { name: { $regex: searchTerm, $options: 'i' } },
    { email: { $regex: searchTerm, $options: 'i' } },
    { phone: { $regex: searchTerm, $options: 'i' } }
  ]
});
Advanced Query Operators:

// Range queries
const recentOrders = await Order.filter({
  created_date: {
    $gte: '2024-01-01',
    $lte: '2024-12-31'
  }
});

// Array contains
const routesWithDriver = await Route.filter({
  order_ids: { $contains: specificOrderId }
});

// Numeric comparisons
const lowStockProducts = await Product.filter({
  stock_quantity: { $lte: { $field: 'min_stock_level' } }
});

// Combined filters
const criticalDisputes = await Dispute.filter({
  $and: [
    { status: 'open' },
    { priority: { $in: ['high', 'critical'] } },
    { due_date: { $lte: new Date().toISOString() } }
  ]
});
Saved Filters:

// User can save frequently used filters
const savedFilters = {
  myOpenDisputes: {
    status: 'open',
    assigned_to: user.id
  },
  urgentHighValue: {
    priority: 'urgent',
    total_amount: { $gte: 1000 }
  }
};

// Store in user preferences
await User.updateMyUserData({ saved_filters: savedFilters });

// Quick access dropdown
<Select onValueChange={(filterName) => applyFilter(savedFilters[filterName])}>
  <SelectItem value="myOpenDisputes">My Open Disputes</SelectItem>
  <SelectItem value="urgentHighValue">Urgent High-Value</SelectItem>
</Select>
4. Data Export System
Export Formats:

CSV Export:

function exportToCsv(data, columns, filename) {
  // Create CSV header
  const header = columns.map(col => col.title).join(',');
  
  // Create CSV rows
  const rows = data.map(item => 
    columns.map(col => {
      let value = item[col.key];
      // Handle special characters
      if (typeof value === 'string' && value.includes(',')) {
        value = `"${value.replace(/"/g, '""')}"`;
      }
      return value;
    }).join(',')
  );
  
  // Combine and download
  const csv = [header, ...rows].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${filename}-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  window.URL.revokeObjectURL(url);
}
Excel Export (via CSV):

// Same as CSV but with .xls extension
// Excel will automatically parse CSV with proper formatting
function exportToExcel(data, columns, filename) {
  exportToCsv(data, columns, filename.replace('.csv', '.xls'));
}
PDF Export (Backend Function):

// Frontend calls backend function
async function exportToPdf(data, options) {
  const { data: pdfBuffer } = await base44.functions.invoke('exportReportPdf', {
    data,
    reportType: options.type,
    title: options.title,
    filters: options.appliedFilters,
    includeCharts: options.includeCharts
  });
  
  // Download PDF
  const blob = new Blob([pdfBuffer], { type: 'application/pdf' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${options.title}-${Date.now()}.pdf`;
  a.click();
  window.URL.revokeObjectURL(url);
}
Bulk Export Modal:

function BulkExportModal({ isOpen, onClose, data, entityName }) {
  const [format, setFormat] = useState('csv');
  const [includeImages, setIncludeImages] = useState(false);
  const [includeRelated, setIncludeRelated] = useState(false);
  
  const handleExport = async () => {
    setIsExporting(true);
    try {
      switch (format) {
        case 'csv':
          exportToCsv(data, columns, entityName);
          break;
        case 'excel':
          exportToExcel(data, columns, entityName);
          break;
        case 'pdf':
          await exportToPdf(data, {
            type: entityName,
            title: `${entityName} Report`,
            includeCharts: includeImages
          });
          break;
      }
      toast({ title: "Export Complete", description: `${data.length} records exported` });
      onClose();
    } catch (error) {
      toast({ 
        title: "Export Failed", 
        description: error.message, 
        variant: "destructive" 
      });
    } finally {
      setIsExporting(false);
    }
  };
  
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Export {entityName}</DialogTitle>
        </DialogHeader>
        
        <div className="space-y-4">
          <div>
            <Label>Format</Label>
            <RadioGroup value={format} onValueChange={setFormat}>
              <div className="flex items-center space-x-2">
                <RadioGroupItem value="csv" id="csv" />
                <Label htmlFor="csv">CSV (Excel compatible)</Label>
              </div>
              <div className="flex items-center space-x-2">
                <RadioGroupItem value="excel" id="excel" />
                <Label htmlFor="excel">Excel (.xls)</Label>
              </div>
              <div className="flex items-center space-x-2">
                <RadioGroupItem value="pdf" id="pdf" />
                <Label htmlFor="pdf">PDF Report</Label>
              </div>
            </RadioGroup>
          </div>
          
          {format === 'pdf' && (
            <div className="flex items-center space-x-2">
              <Checkbox 
                id="includeCharts" 
                checked={includeImages}
                onCheckedChange={setIncludeImages}
              />
              <Label htmlFor="includeCharts">Include charts and visualizations</Label>
            </div>
          )}
          
          <div className="flex items-center space-x-2">
            <Checkbox 
              id="includeRelated" 
              checked={includeRelated}
              onCheckedChange={setIncludeRelated}
            />
            <Label htmlFor="includeRelated">Include related data (e.g., order items)</Label>
          </div>
          
          <Alert>
            <AlertDescription>
              Exporting {data.length} records
            </AlertDescription>
          </Alert>
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={onClose}>Cancel</Button>
          <Button onClick={handleExport} disabled={isExporting}>
            {isExporting ? (
              <>
                <RefreshCw className="mr-2 h-4 w-4 animate-spin" />
                Exporting...
              </>
            ) : (
              <>
                <Download className="mr-2 h-4 w-4" />
                Export
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
5. Bulk Operations
Bulk Action Toolbar:

function BulkActionToolbar({ selectedItems, onAction, entity }) {
  const [isOpen, setIsOpen] = useState(false);
  
  if (selectedItems.length === 0) return null;
  
  return (
    <motion.div 
      initial={{ opacity: 0, y: -20 }}
      animate={{ opacity: 1, y: 0 }}
      className="fixed bottom-0 left-0 right-0 bg-blue-600 text-white p-4 shadow-lg z-50"
    >
      <div className="container mx-auto flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Checkbox 
            checked={true}
            className="border-white"
          />
          <span className="font-medium">
            {selectedItems.length} items selected
          </span>
        </div>
        
        <div className="flex items-center gap-2">
          <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>
            <DropdownMenuTrigger asChild>
              <Button variant="secondary">
                Bulk Actions <ChevronDown className="ml-2 h-4 w-4" />
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end">
              {getBulkActions(entity).map(action => (
                <DropdownMenuItem 
                  key={action.key}
                  onClick={() => onAction(action.key, selectedItems)}
                >
                  <action.icon className="mr-2 h-4 w-4" />
                  {action.label}
                </DropdownMenuItem>
              ))}
            </DropdownMenuContent>
          </DropdownMenu>
          
          <Button 
            variant="outline" 
            className="bg-white text-blue-600"
            onClick={() => onAction('export', selectedItems)}
          >
            <Download className="mr-2 h-4 w-4" />
            Export Selected
          </Button>
          
          <Button 
            variant="ghost" 
            className="text-white hover:bg-blue-700"
            onClick={() => onAction('deselect', [])}
          >
            <X className="h-4 w-4" />
          </Button>
        </div>
      </div>
    </motion.div>
  );
}
Entity-Specific Bulk Actions:

function getBulkActions(entity) {
  const actions = {
    Order: [
      { key: 'changeStatus', label: 'Change Status', icon: Edit },
      { key: 'assignDriver', label: 'Assign to Driver', icon: Users },
      { key: 'addToRoute', label: 'Add to Route', icon: Truck },
      { key: 'generateInvoices', label: 'Generate Invoices', icon: FileText },
      { key: 'sendNotifications', label: 'Send Notifications', icon: Mail },
      { key: 'delete', label: 'Delete Selected', icon: Trash2, variant: 'destructive' }
    ],
    Product: [
      { key: 'changeStatus', label: 'Change Status', icon: Edit },
      { key: 'updatePrices', label: 'Update Prices', icon: DollarSign },
      { key: 'adjustInventory', label: 'Adjust Inventory', icon: Package },
      { key: 'assignSupplier', label: 'Assign Supplier', icon: Truck },
      { key: 'delete', label: 'Delete Selected', icon: Trash2, variant: 'destructive' }
    ],
    Dispute: [
      { key: 'assignTo', label: 'Assign To', icon: UserPlus },
      { key: 'changePriority', label: 'Change Priority', icon: Flag },
      { key: 'changeStatus', label: 'Change Status', icon: Edit },
      { key: 'addTags', label: 'Add Tags', icon: Tag },
      { key: 'closeAll', label: 'Close All', icon: CheckCircle }
    ],
    Invoice: [
      { key: 'markPaid', label: 'Mark as Paid', icon: CheckCircle },
      { key: 'sendReminders', label: 'Send Reminders', icon: Mail },
      { key: 'voidInvoices', label: 'Void Invoices', icon: XCircle },
      { key: 'exportPdfs', label: 'Export PDFs', icon: Download }
    ],
    // ... more entities
  };
  
  return actions[entity] || [];
}
Bulk Action Execution:

async function executeBulkAction(action, selectedItems, options) {
  const confirmationNeeded = ['delete', 'voidInvoices', 'closeAll'].includes(action);
  
  if (confirmationNeeded) {
    const confirmed = await showConfirmDialog({
      title: `Confirm ${action}`,
      description: `Are you sure you want to ${action} ${selectedItems.length} items?`,
      confirmText: 'Yes, proceed',
      cancelText: 'Cancel'
    });
    
    if (!confirmed) return;
  }
  
  const results = {
    success: 0,
    failed: 0,
    errors: []
  };
  
  // Show progress toast
  const progressToast = toast({
    title: "Processing...",
    description: `0 / ${selectedItems.length} completed`,
    duration: Infinity
  });
  
  for (let i = 0; i < selectedItems.length; i++) {
    try {
      await performAction(action, selectedItems[i], options);
      results.success++;
      
      // Update progress
      toast.update(progressToast, {
        description: `${i + 1} / ${selectedItems.length} completed`
      });
      
      // Rate limiting delay
      await delay(500);
    } catch (error) {
      results.failed++;
      results.errors.push({
        item: selectedItems[i],
        error: error.message
      });
    }
  }
  
  // Dismiss progress toast
  toast.dismiss(progressToast);
  
  // Show results
  if (results.failed === 0) {
    toast({
      title: "Bulk Action Complete",
      description: `Successfully processed ${results.success} items`
    });
  } else {
    toast({
      title: "Bulk Action Completed with Errors",
      description: `${results.success} succeeded, ${results.failed} failed`,
      variant: "destructive"
    });
    
    // Show error details modal
    showErrorDetailsModal(results.errors);
  }
  
  // Refresh data
  await refreshData();
}
Bulk Status Update Modal:

function BulkStatusUpdateModal({ isOpen, onClose, selectedItems, entity }) {
  const [newStatus, setNewStatus] = useState('');
  const [reason, setReason] = useState('');
  
  const statusOptions = getStatusOptionsForEntity(entity);
  
  const handleSubmit = async () => {
    await executeBulkAction('changeStatus', selectedItems, {
      status: newStatus,
      reason
    });
    onClose();
  };
  
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Update Status for {selectedItems.length} Items</DialogTitle>
        </DialogHeader>
        
        <div className="space-y-4">
          <div>
            <Label>New Status</Label>
            <Select value={newStatus} onValueChange={setNewStatus}>
              <SelectTrigger>
                <SelectValue placeholder="Select status" />
              </SelectTrigger>
              <SelectContent>
                {statusOptions.map(option => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
          
          <div>
            <Label>Reason (Optional)</Label>
            <Textarea
              value={reason}
              onChange={(e) => setReason(e.target.value)}
              placeholder="Enter reason for status change..."
            />
          </div>
          
          <Alert>
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>
              This will update the status of {selectedItems.length} selected items
            </AlertDescription>
          </Alert>
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={onClose}>Cancel</Button>
          <Button onClick={handleSubmit} disabled={!newStatus}>
            Update Status
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
6. Responsive Design
Breakpoint Strategy:

/* Tailwind breakpoints used throughout */
sm: 640px   /* Small tablets */
md: 768px   /* Tablets */
lg: 1024px  /* Desktop */
xl: 1280px  /* Large desktop */
2xl: 1536px /* Extra large */
Mobile-First Components:

Responsive DataTable:

function ResponsiveDataTable({ data, columns }) {
  const isMobile = useMediaQuery('(max-width: 768px)');
  
  if (isMobile) {
    // Card view for mobile
    return (
      <div className="space-y-4">
        {data.map(item => (
          <Card key={item.id}>
            <CardContent className="p-4">
              {columns.map(col => (
                <div key={col.key} className="flex justify-between py-2 border-b last:border-0">
                  <span className="font-medium text-gray-600">{col.title}</span>
                  <span>{renderCellValue(item[col.key], col.type)}</span>
                </div>
              ))}
              <div className="mt-4 flex gap-2">
                <Button size="sm" variant="outline">View</Button>
                <Button size="sm" variant="outline">Edit</Button>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }
  
  // Table view for desktop
  return (
    <Table>
      {/* Standard table markup */}
    </Table>
  );
}
Responsive Sidebar:

// Layout.js
const [isSidebarOpen, setIsSidebarOpen] = useState(true);
const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

// Desktop: Collapsible sidebar
<div className={`
  fixed inset-y-0 left-0 z-50
  bg-white dark:bg-slate-800
  border-r border-gray-200 dark:border-slate-700
  flex flex-col
  transition-all duration-300
  ${isSidebarOpen ? 'w-64' : 'w-20'}
  lg:translate-x-0
  ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}
`}>
  {/* Sidebar content */}
</div>

// Mobile: Overlay sidebar
{isMobileMenuOpen && (
  <div 
    className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
    onClick={() => setIsMobileMenuOpen(false)}
  />
)}
Responsive Grid Layouts:

// Dashboard grid adjusts to screen size
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
  <StatsCard />
  <StatsCard />
  <StatsCard />
  <StatsCard />
</div>

// Form fields stack on mobile, side-by-side on desktop
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  <Input label="First Name" />
  <Input label="Last Name" />
</div>

// Complex layouts with varying column spans
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div className="lg:col-span-2">
    <RevenueChart />
  </div>
  <div>
    <OrderStatusCard />
    <AlertsCard />
  </div>
</div>
Touch-Friendly Interactions:

// Larger touch targets on mobile
<Button className={`
  ${isMobile ? 'h-12 px-6' : 'h-10 px-4'}
  text-base
`}>
  Tap Me
</Button>

// Swipe gestures for cards (using Framer Motion)
<motion.div
  drag="x"
  dragConstraints={{ left: 0, right: 0 }}
  onDragEnd={(e, { offset }) => {
    if (offset.x > 100) handleSwipeRight();
    if (offset.x < -100) handleSwipeLeft();
  }}
>
  {/* Card content */}
</motion.div>

// Pull-to-refresh (mobile)
<div
  onTouchStart={handleTouchStart}
  onTouchMove={handleTouchMove}
  onTouchEnd={handleTouchEnd}
>
  {isRefreshing && <RefreshIndicator />}
  {/* Content */}
</div>
Responsive Typography:

// Headings scale with screen size
<h1 className="text-2xl md:text-3xl lg:text-4xl font-bold">
  Dashboard
</h1>

// Body text adjusts for readability
<p className="text-sm md:text-base">
  Description text...
</p>

// Tables use smaller text on mobile
<Table className="text-xs sm:text-sm">
  {/* Table content */}
</Table>
7. Performance Optimizations
Lazy Loading:

// Code splitting for routes
const AdminDashboard = lazy(() => import('./pages/AdminDashboard'));
const AdminOrders = lazy(() => import('./pages/AdminOrders'));
const AdminInventory = lazy(() => import('./pages/AdminInventory'));
// ... etc

// Lazy load heavy components
const RouteMap = lazy(() => import('./components/admin/RouteMap'));
const AnalyticsCharts = lazy(() => import('./components/analytics/Charts'));

// Usage with Suspense
<Suspense fallback={<LoadingSpinner />}>
  <RouteMap route={currentRoute} />
</Suspense>
React Query Caching:

// Query with caching and stale time
const { data: products } = useQuery({
  queryKey: ['products', companyFilter],
  queryFn: () => base44.entities.Product.filter({ company_id: companyFilter }),
  staleTime: 5 * 60 * 1000, // Consider data fresh for 5 minutes
  cacheTime: 10 * 60 * 1000, // Keep in cache for 10 minutes
  refetchOnWindowFocus: false
});

// Prefetching related data
const queryClient = useQueryClient();

// When hovering over product, prefetch details
const handleMouseEnter = (productId) => {
  queryClient.prefetchQuery({
    queryKey: ['product', productId],
    queryFn: () => base44.entities.Product.get(productId)
  });
};
Virtualization for Large Lists:

import { FixedSizeList } from 'react-window';

function VirtualizedProductList({ products }) {
  const Row = ({ index, style }) => (
    <div style={style} className="border-b p-4">
      <ProductCard product={products[index]} />
    </div>
  );
  
  return (
    <FixedSizeList
      height={600}
      itemCount={products.length}
      itemSize={120}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
}
Image Optimization:

// Lazy load images
<img 
  src={product.image_url} 
  alt={product.name}
  loading="lazy"
  className="w-full h-48 object-cover"
/>

// Progressive image loading
function ProgressiveImage({ src, placeholder }) {
  const [imgSrc, setImgSrc] = useState(placeholder);
  
  useEffect(() => {
    const img = new Image();
    img.src = src;
    img.onload = () => setImgSrc(src);
  }, [src]);
  
  return (
    <img 
      src={imgSrc} 
      className={`transition-opacity duration-300 ${
        imgSrc === placeholder ? 'opacity-50' : 'opacity-100'
      }`}
    />
  );
}
Debouncing Search:

import { useDebouncedValue } from '@/hooks/useDebounce';

function SearchInput({ onSearch }) {
  const [searchTerm, setSearchTerm] = useState('');
  const debouncedSearchTerm = useDebouncedValue(searchTerm, 500);
  
  useEffect(() => {
    if (debouncedSearchTerm) {
      onSearch(debouncedSearchTerm);
    }
  }, [debouncedSearchTerm]);
  
  return (
    <Input
      value={searchTerm}
      onChange={(e) => setSearchTerm(e.target.value)}
      placeholder="Search..."
    />
  );
}
Memoization:

// Expensive calculations
const totalRevenue = useMemo(() => {
  return invoices
    .filter(inv => inv.payment_status === 'paid')
    .reduce((sum, inv) => sum + inv.total_amount, 0);
}, [invoices]);

// Memoized components
const MemoizedProductCard = memo(ProductCard, (prevProps, nextProps) => {
  return prevProps.product.id === nextProps.product.id &&
         prevProps.product.updated_date === nextProps.product.updated_date;
});

// Callback memoization
const handleEdit = useCallback((product) => {
  setEditingProduct(product);
  setIsModalOpen(true);
}, []);
8. Error Handling
Global Error Boundary:

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }
  
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  
  componentDidCatch(error, errorInfo) {
    // Log to error tracking service
    console.error('Error caught by boundary:', error, errorInfo);
    
    // Could send to Sentry, LogRocket, etc.
    // logErrorToService(error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-slate-900">
          <Card className="max-w-md">
            <CardHeader>
              <CardTitle className="text-red-600">Something went wrong</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-gray-600 mb-4">
                An unexpected error occurred. Our team has been notified.
              </p>
              <details className="mb-4">
                <summary className="cursor-pointer text-sm text-gray-500">
                  Error details
                </summary>
                <pre className="mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto">
                  {this.state.error?.toString()}
                </pre>
              </details>
              <Button onClick={() => window.location.reload()}>
                Reload Page
              </Button>
            </CardContent>
          </Card>
        </div>
      );
    }
    
    return this.props.children;
  }
}

// Usage in root
<ErrorBoundary>
  <App />
</ErrorBoundary>
API Error Handling:

// Centralized API error handler
async function handleApiCall(apiFunction, options = {}) {
  const { 
    showLoading = true, 
    showSuccessToast = false,
    successMessage = 'Operation successful',
    retries = 2 
  } = options;
  
  if (showLoading) {
    // Show loading indicator
  }
  
  try {
    const result = await fetchWithRetry(apiFunction, 'API', retries);
    
    if (showSuccessToast) {
      toast({
        title: "Success",
        description: successMessage
      });
    }
    
    return result;
  } catch (error) {
    const errorMessage = getErrorMessage(error);
    
    toast({
      title: "Error",
      description: errorMessage,
      variant: "destructive"
    });
    
    // Specific error handling
    if (error.response?.status === 401) {
      // Unauthorized - redirect to login
      base44.auth.redirectToLogin();
    } else if (error.response?.status === 403) {
      // Forbidden - show permission denied
      navigate(createPageUrl('PermissionDenied'));
    } else if (error.response?.status === 404) {
      // Not found
      console.error('Resource not found');
    } else if (error.response?.status === 429) {
      // Rate limited - already handled by fetchWithRetry
      console.warn('Rate limited');
    } else {
      // Generic error
      console.error('API Error:', error);
    }
    
    throw error; // Re-throw for component-level handling
  } finally {
    if (showLoading) {
      // Hide loading indicator
    }
  }
}

function getErrorMessage(error) {
  if (error.response?.data?.message) {
    return error.response.data.message;
  }
  if (error.message) {
    return error.message;
  }
  return 'An unexpected error occurred';
}
Form Validation Errors:

function ProductForm({ onSubmit }) {
  const [errors, setErrors] = useState({});
  
  const validate = (formData) => {
    const newErrors = {};
    
    if (!formData.name) {
      newErrors.name = 'Product name is required';
    }
    
    if (!formData.sku) {
      newErrors.sku = 'SKU is required';
    } else if (formData.sku.length < 3) {
      newErrors.sku = 'SKU must be at least 3 characters';
    }
    
    if (!formData.price || formData.price <= 0) {
      newErrors.price = 'Price must be greater than 0';
    }
    
    if (!formData.cost_price || formData.cost_price <= 0) {
      newErrors.cost_price = 'Cost price must be greater than 0';
    }
    
    if (formData.price <= formData.cost_price) {
      newErrors.price = 'Price must be greater than cost';
    }
    
    return newErrors;
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Validate
    const validationErrors = validate(data);
    if (Object.keys(validationErrors).length > 0) {
      setErrors(validationErrors);
      toast({
        title: "Validation Error",
        description: "Please fix the errors and try again",
        variant: "destructive"
      });
      return;
    }
    
    // Clear errors
    setErrors({});
    
    // Submit
    try {
      await onSubmit(data);
    } catch (error) {
      // Handle submission error
      if (error.response?.data?.errors) {
        setErrors(error.response.data.errors);
      }
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <div>
        <Label>Product Name *</Label>
        <Input name="name" />
        {errors.name && (
          <p className="text-red-500 text-sm mt-1">{errors.name}</p>
        )}
      </div>
      
      {/* More fields... */}
      
      <Button type="submit">Save Product</Button>
    </form>
  );
}
9. Internationalization (i18n)
Translation System:

// translations.js (expanded)
export const translations = {
  en: {
    // Navigation
    nav_dashboard: "Dashboard",
    nav_analytics: "Analytics",
    nav_operations: "Operations",
    nav_clients: "Clients",
    nav_departments: "Departments",
    // ... hundreds of keys
    
    // Common
    save: "Save",
    cancel: "Cancel",
    delete: "Delete",
    edit: "Edit",
    view: "View",
    export: "Export",
    import: "Import",
    search: "Search",
    filter: "Filter",
    
    // Validation
    validation_required: "This field is required",
    validation_email: "Invalid email address",
    validation_min_length: "Minimum {min} characters required",
    validation_positive: "Must be a positive number",
    
    // Status
    status_active: "Active",
    status_inactive: "Inactive",
    status_pending: "Pending",
    status_completed: "Completed",
    
    // ... more translations
  },
  es: {
    // Spanish translations
    nav_dashboard: "Tablero",
    nav_analytics: "Analíticas",
    nav_operations: "Operaciones",
    nav_clients: "Clientes",
    nav_departments: "Departamentos",
    // ... etc
    
    save: "Guardar",
    cancel: "Cancelar",
    delete: "Eliminar",
    edit: "Editar",
    view: "Ver",
    export: "Exportar",
    import: "Importar",
    search: "Buscar",
    filter: "Filtrar",
    
    // ... more translations
  }
};
i18n Context:

// I18nContext.js (as provided)
const I18nContext = createContext();

export const useI18n = () => useContext(I18nContext);

export default I18nContext;
Usage in Components:

import { useI18n } from '@/components/i18n/I18nContext';

function OrdersPage() {
  const { t, language, toggleLanguage } = useI18n();
  
  return (
    <div>
      <h1>{t.pageTitle_orders}</h1>
      <Button>{t.createOrder}</Button>
      
      <DataTable
        title={t.recentOrders}
        columns={[
          { key: 'order_number', title: t.orderNumber },
          { key: 'customer_name', title: t.customer },
          { key: 'total_amount', title: t.amount },
          { key: 'status', title: t.status }
        ]}
        emptyMessage={t.noOrdersFound}
      />
      
      {/* Language toggle */}
      <Button onClick={toggleLanguage}>
        {language === 'en' ? 'Español' : 'English'}
      </Button>
    </div>
  );
}
Dynamic Translations with Interpolation:

// Translation with placeholders
const translations = {
  en: {
    items_selected: "{count} items selected",
    welcome_user: "Welcome, {name}!",
    order_total: "Order #{orderNumber} total: ${amount}"
  },
  es: {
    items_selected: "{count} elementos seleccionados",
    welcome_user: "¡Bienvenido, {name}!",
    order_total: "Pedido #{orderNumber} total: ${amount}"
  }
};

// Interpolation function
function interpolate(template, values) {
  return template.replace(/{(\w+)}/g, (match, key) => {
    return values[key] !== undefined ? values[key] : match;
  });
}

// Usage
const message = interpolate(t.items_selected, { count: 5 });
// Result: "5 items selected" or "5 elementos seleccionados"
RTL Support (if needed for Arabic/Hebrew):

// Layout adjusts direction based on language
<div dir={language === 'ar' || language === 'he' ? 'rtl' : 'ltr'}>
  {/* App content */}
</div>

// CSS adapts
className={`
  ${isRTL ? 'mr-4' : 'ml-4'}
  ${isRTL ? 'text-right' : 'text-left'}
`}
10. Dark Mode Implementation
Theme System:

// Layout.js
const [theme, setTheme] = useState('dark');

useEffect(() => {
  // Load from localStorage or user preference
  const storedTheme = localStorage.getItem('theme') || user?.theme || 'dark';
  setTheme(storedTheme);
  document.documentElement.className = storedTheme;
}, [user]);

const toggleTheme = async () => {
  const newTheme = theme === 'light' ? 'dark' : 'light';
  setTheme(newTheme);
  localStorage.setItem('theme', newTheme);
  document.documentElement.className = newTheme;
  
  // Persist to user profile
  if (user) {
    await User.updateMyUserData({ theme: newTheme });
  }
};
CSS Variables Approach:

/* globals.css */
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
  /* ... more variables */
}

.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --primary: 217.2 91.2% 59.8%;
  --primary-foreground: 222.2 47.4% 11.2%;
  /* ... more variables */
}
Component Usage:

// Components automatically adapt
<Card className="bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700">
  <CardTitle className="text-slate-900 dark:text-white">
    Dashboard
  </CardTitle>
  <CardContent className="text-slate-600 dark:text-slate-300">
    Content here...
  </CardContent>
</Card>

// Charts adapt colors
const chartColors = {
  light: {
    primary: '#3B82F6',
    secondary: '#10B981',
    background: '#FFFFFF'
  },
  dark: {
    primary: '#60A5FA',
    secondary: '#34D399',
    background: '#1E293B'
  }
};

const currentColors = chartColors[theme];
Summary
The Admin Portal is a comprehensive, enterprise-grade application with the following characteristics:

Architecture:

Multi-company support with seamless switching
Role-based access control with fine-grained permissions
Real-time updates via polling
Responsive design for all device sizes
Dark/light mode with user preferences
Internationalization (English/Spanish)
Key Capabilities:

Complete CRUD operations on all entities
Advanced filtering, search, and sorting
Bulk operations for efficiency
Data export in multiple formats (CSV, Excel, PDF)
Comprehensive audit logging
Financial management and reconciliation
Inventory tracking and alerts
Route optimization and logistics
Customer dispute resolution
Internal team communication (chat)
Integration with external systems (QuickBooks, Stripe, etc.)
User Experience:

Intuitive navigation with collapsible sidebar
Contextual actions and shortcuts
Toast notifications for feedback
Loading states and error handling
Drag-and-drop interfaces where applicable
Progressive enhancement
Accessible design (WCAG compliant)
Performance:

Code splitting and lazy loading
React Query for caching
Virtualization for large datasets
Image optimization
Debounced searches
Memoization of expensive calculations
Security:

Authentication required for all pages
Authorization checks on every action
Complete audit trail (UserLogs)
Encrypted sensitive data
Rate limiting on API calls
Session management
IP whitelisting capability
The Admin Portal serves as the central nervous system of the TimeFlow Operations platform, providing administrators with the tools they need to efficiently manage a complex, multi-company distribution and logistics operation.




